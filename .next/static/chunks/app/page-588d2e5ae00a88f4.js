(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2869:function(e,s,t){Promise.resolve().then(t.bind(t,7595))},7595:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return er}});var r=t(7437),a=t(2265),l=t(6580);let n="https://xqnuisomilcosghbajyu.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhxbnVpc29taWxjb3NnaGJhanl1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIxNTY5NzYsImV4cCI6MjA2NzczMjk3Nn0.M3r2hJ1IvRi-eh0hLOjQA6uHtYCqj1HjvZeTGlHbX-w";if(!n||!i)throw Error("Missing Supabase environment variables. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY in your .env.local file.");let o=(0,l.eI)(n,i,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!1}});var d=t(6904),c=t(6747),x=t(5252),m=t(5291),u=t(6141);function g(){let[e,s]=(0,a.useState)(""),[t,l]=(0,a.useState)(""),[n,i]=(0,a.useState)(!1),[g,h]=(0,a.useState)(!1),[p,b]=(0,a.useState)(""),f=async s=>{s.preventDefault(),h(!0),b("");try{let{error:s}=await o.auth.signInWithPassword({email:e,password:t});s&&b(s.message)}catch(e){b("Terjadi kesalahan yang tidak terduga")}finally{h(!1)}};return(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center px-4 py-12",children:(0,r.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"mx-auto h-16 w-16 bg-gradient-to-r from-loreal-orange to-loreal-red rounded-2xl flex items-center justify-center mb-6 shadow-lg",children:(0,r.jsx)(d.Z,{className:"h-8 w-8 text-white"})}),(0,r.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Selamat Datang di L'Or\xe9al"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Platform Asisten Penjualan"})]}),(0,r.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[(0,r.jsxs)("form",{onSubmit:f,className:"space-y-6",children:[p&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm",children:p}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Alamat Email"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,r.jsx)(c.Z,{className:"h-5 w-5 text-gray-400"})}),(0,r.jsx)("input",{id:"email",type:"email",value:e,onChange:e=>s(e.target.value),required:!0,className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-loreal-orange focus:border-transparent transition-colors",placeholder:"Masukkan email Anda"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Kata Sandi"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,r.jsx)(x.Z,{className:"h-5 w-5 text-gray-400"})}),(0,r.jsx)("input",{id:"password",type:n?"text":"password",value:t,onChange:e=>l(e.target.value),required:!0,className:"block w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-loreal-orange focus:border-transparent transition-colors",placeholder:"Masukkan kata sandi Anda"}),(0,r.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>i(!n),children:n?(0,r.jsx)(m.Z,{className:"h-5 w-5 text-gray-400 hover:text-gray-600"}):(0,r.jsx)(u.Z,{className:"h-5 w-5 text-gray-400 hover:text-gray-600"})})]})]}),(0,r.jsx)("button",{type:"submit",disabled:g,className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-gradient-to-r from-loreal-orange to-loreal-red hover:from-orange-600 hover:to-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-loreal-orange disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",children:g?(0,r.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):"Masuk"})]}),(0,r.jsx)("div",{className:"mt-6 text-center",children:(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Untuk demo, hubungi administrator untuk kredensial login"})})]})]})})}var h=t(9049),p=t(2857),b=t(1520),f=t(3254),j=t(9701),y=t(339),N=t(4986),v=t(3683),w=t(6818),_=t(6275),k=t(4585),S=t(3147),C=t(9626);function O(e){let{user:s,onClose:t,onSuccess:l}=e,[n,i]=(0,a.useState)([]),[d,c]=(0,a.useState)([]),[x,m]=(0,a.useState)([]),[u,g]=(0,a.useState)([]),[h,p]=(0,a.useState)([]),[b,f]=(0,a.useState)([]),[j,y]=(0,a.useState)([]),[v,w]=(0,a.useState)(""),[_,k]=(0,a.useState)({}),[O,E]=(0,a.useState)(""),[T,R]=(0,a.useState)(""),[A,L]=(0,a.useState)(""),[M,P]=(0,a.useState)(null),[U,D]=(0,a.useState)(!1),[Z,I]=(0,a.useState)({store_name:"",store_code:"",category:"",address:"",route:"A"}),[V,q]=(0,a.useState)(new Date().toISOString().split("T")[0]),[K,F]=(0,a.useState)(!1),[G,B]=(0,a.useState)(""),[z,Y]=(0,a.useState)(""),[W,H]=(0,a.useState)([]),[J,Q]=(0,a.useState)(!1),[X,$]=(0,a.useState)(!0),[ee,es]=(0,a.useState)(!1),[et,er]=(0,a.useState)(!1),ea=e=>{let s=e.quantity*e.unit_price,t=e.discount_percentage/100*s;return s-t},el=e=>{H(s=>s.filter((s,t)=>t!==e)),k(s=>{let t={...s};return delete t[e],t})},en=(e,s,t)=>{if(H(r=>r.map((r,a)=>a===e?{...r,[s]:t}:r)),"product_id"===s&&t){let s=d.find(e=>e.id===t);s&&H(t=>t.map((t,r)=>r===e?{...t,unit_price:s.unit_price}:t))}},ei=(e,s)=>{k(t=>({...t,[e]:s}))};(0,a.useEffect)(()=>{eo(),ed()},[]),(0,a.useEffect)(()=>{T&&ec()},[T]),(0,a.useEffect)(()=>{K&&ex()},[K]),(0,a.useEffect)(()=>{let e=n;O&&(e=e.filter(e=>e.route===O)),T&&(e=e.filter(e=>e.category===T)),v.trim()&&(e=e.filter(e=>e.store_name.toLowerCase().includes(v.toLowerCase())||e.store_code.toLowerCase().includes(v.toLowerCase()))),f(e)},[n,O,T,v]);let eo=async()=>{try{let{data:e,error:t}=await o.from("stores").select("id, store_name, store_code, address, route, category").eq("created_by",s.id).order("store_name");if(t)throw t;i(e||[])}catch(e){console.error("Error fetching stores:",e)}finally{$(!1)}},ed=async()=>{try{let{data:e,error:t}=await o.from("stores").select("route, category").eq("created_by",s.id);if(t)throw t;let r=[...new Set((e||[]).map(e=>e.route).filter(Boolean))].sort(),a=[...new Set((e||[]).map(e=>e.category).filter(Boolean))].sort();g(r),p(a)}catch(e){console.error("Error fetching routes and categories:",e)}},ec=async()=>{if(T){er(!0);try{let{data:e,error:s}=await o.from("msl_items").select("id, sku_code, product_name, priority").eq("category",T).order("priority");if(s)throw s;m(e||[])}catch(e){console.error("Error fetching MSL items:",e),m([])}finally{er(!1)}}},ex=async()=>{es(!0);try{let{data:e,error:s}=await o.from("products").select("id, sku_code, product_name, unit_price").eq("is_active",!0).order("product_name");if(s)throw s;c(e||[])}catch(e){console.error("Error fetching products:",e)}finally{es(!1)}},em=e=>{L(e),P(n.find(s=>s.id===e)||null)},eu=e=>x.some(s=>s.sku_code===e),eg=async e=>{if(e.preventDefault(),(A||U)&&(!U||Z.store_name&&Z.store_code&&Z.category)&&(K||G)){Q(!0);try{let e=A;if(U){let{data:t,error:r}=await o.from("stores").insert({store_name:Z.store_name,store_code:Z.store_code,category:Z.category,address:Z.address,route:Z.route,created_by:s.id}).select().single();if(r)throw r;e=t.id}let{data:r,error:a}=await o.from("visits").insert({salesman_id:s.id,store_id:e,visit_date:V,has_order:K,notes:K?z||null:G}).select().single();if(a)throw a;if(K&&W.length>0){let e=W.filter(e=>e.product_id&&e.quantity>0&&e.unit_price>0);if(e.length>0){let s=e.map(e=>({visit_id:r.id,product_id:e.product_id,quantity:e.quantity,unit_price:e.unit_price,discount_percentage:e.discount_percentage,line_total:ea(e)})),{error:t}=await o.from("visit_orders").insert(s);if(t)throw t}}l(),t()}catch(e){console.error("Error creating visit:",e),alert("Gagal menyimpan kunjungan. Silakan coba lagi.")}finally{Q(!1)}}};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"h-10 w-10 bg-green-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(S.Z,{className:"h-5 w-5 text-green-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Tambah Kunjungan Toko"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Catat kunjungan dan pesanan hari ini"})]})]}),(0,r.jsx)("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,r.jsx)(N.Z,{className:"h-5 w-5 text-gray-500"})})]}),(0,r.jsxs)("form",{onSubmit:eg,className:"p-6 space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tanggal Kunjungan"}),(0,r.jsx)("input",{type:"date",value:V,onChange:e=>q(e.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-gray-900",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih Route"}),(0,r.jsxs)("select",{value:O,onChange:e=>E(e.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-gray-900",children:[(0,r.jsx)("option",{value:"",children:"Semua Route"}),u.map(e=>(0,r.jsxs)("option",{value:e,children:["Route ",e]},e))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih Kategori Toko"}),(0,r.jsxs)("select",{value:T,onChange:e=>R(e.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-gray-900",children:[(0,r.jsx)("option",{value:"",children:"Semua Kategori"}),h.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),(0,r.jsx)("div",{children:(0,r.jsxs)("label",{className:"flex items-center space-x-3",children:[(0,r.jsx)("input",{type:"checkbox",checked:U,onChange:e=>D(e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Toko Baru/Toko Belum Terdaftar"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Tidak menemukan toko?"})]})]})}),U?(0,r.jsxs)("div",{className:"space-y-3 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,r.jsx)("h3",{className:"font-medium text-blue-900",children:"Data Toko Baru"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama Toko *"}),(0,r.jsx)("input",{type:"text",value:Z.store_name,onChange:e=>I(s=>({...s,store_name:e.target.value})),className:"w-full p-2 border border-gray-300 rounded text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Nama toko",required:U})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kode Toko *"}),(0,r.jsx)("input",{type:"text",value:Z.store_code,onChange:e=>I(s=>({...s,store_code:e.target.value})),className:"w-full p-2 border border-gray-300 rounded text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Kode toko",required:U})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kategori *"}),(0,r.jsxs)("select",{value:Z.category,onChange:e=>I(s=>({...s,category:e.target.value})),className:"w-full p-2 border border-gray-300 rounded text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500",required:U,children:[(0,r.jsx)("option",{value:"",children:"Pilih kategori..."}),h.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Route *"}),(0,r.jsxs)("select",{value:Z.route,onChange:e=>I(s=>({...s,route:e.target.value})),className:"w-full p-2 border border-gray-300 rounded text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500",required:U,children:[(0,r.jsx)("option",{value:"",children:"Pilih route..."}),u.map(e=>(0,r.jsxs)("option",{value:e,children:["Route ",e]},e))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Alamat"}),(0,r.jsx)("input",{type:"text",value:Z.address,onChange:e=>I(s=>({...s,address:e.target.value})),className:"w-full p-2 border border-gray-300 rounded text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Alamat toko (opsional)"})]})]})]}):(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih Toko"}),X?(0,r.jsx)("div",{className:"p-3 text-gray-500",children:"Memuat daftar toko..."}):(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("input",{type:"text",value:v,onChange:e=>w(e.target.value),className:"w-full p-2 border border-gray-300 rounded text-gray-900 focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"Cari toko..."}),(0,r.jsxs)("select",{value:A,onChange:e=>em(e.target.value),className:"w-full p-2 border border-gray-300 rounded text-gray-900 focus:outline-none focus:ring-2 focus:ring-green-500",required:!U,children:[(0,r.jsx)("option",{value:"",children:"Pilih toko..."}),b.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.store_name," (",e.store_code,") - ",e.category," - Route ",e.route]},e.id))]}),0===b.length&&v&&(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:'Tidak ada toko yang ditemukan. Coba kata kunci lain atau centang "Toko Baru".'})]})]}),M&&x.length>0&&(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,r.jsxs)("h3",{className:"font-medium text-blue-900 mb-3",children:["Top 5 MSL Recommendations untuk ",M.category]}),et?(0,r.jsx)("div",{className:"text-blue-700",children:"Memuat rekomendasi MSL..."}):(0,r.jsx)("div",{className:"space-y-2",children:x.slice(0,5).map((e,s)=>(0,r.jsxs)("div",{className:"flex items-center text-sm text-blue-800",children:[(0,r.jsx)("span",{className:"w-6 h-6 bg-blue-200 text-blue-800 rounded-full flex items-center justify-center text-xs font-bold mr-3",children:e.priority}),(0,r.jsx)("span",{className:"font-mono mr-3 text-xs",children:e.sku_code}),(0,r.jsx)("span",{className:"text-xs",children:e.product_name})]},e.id))})]}),(0,r.jsx)("div",{children:(0,r.jsxs)("label",{className:"flex items-center space-x-3",children:[(0,r.jsx)("input",{type:"checkbox",checked:K,onChange:e=>F(e.target.checked),className:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded"}),(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Ada pesanan produk"})]})}),!K&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Alasan Tidak Order *"}),(0,r.jsxs)("select",{value:G,onChange:e=>B(e.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-gray-900",required:!K,children:[(0,r.jsx)("option",{value:"",children:"Pilih alasan..."}),["Toko tutup","Stock masih ada","Owner tidak ada","Harga tidak masuk","Orderan tidak dikirim","Lainnya"].map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),K&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Daftar Pesanan"}),(0,r.jsxs)("button",{type:"button",onClick:()=>{H(e=>[...e,{product_id:"",quantity:1,unit_price:0,discount_percentage:0}])},className:"inline-flex items-center px-3 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,r.jsx)(C.Z,{className:"h-4 w-4 mr-1"}),"Tambah Item"]})]}),ee?(0,r.jsx)("div",{className:"p-3 text-gray-500",children:"Memuat daftar produk..."}):(0,r.jsxs)("div",{className:"space-y-3",children:[W.map((e,s)=>(0,r.jsxs)("div",{className:"grid grid-cols-12 gap-3 p-3 bg-gray-50 rounded-lg",children:[(0,r.jsxs)("div",{className:"col-span-5",children:[(0,r.jsx)("input",{type:"text",value:_[s]||"",onChange:e=>ei(s,e.target.value),className:"w-full p-2 border border-gray-300 rounded text-sm text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 mb-1",placeholder:"Cari produk..."}),(0,r.jsxs)("select",{value:e.product_id,onChange:e=>en(s,"product_id",e.target.value),className:"w-full p-2 border border-gray-300 rounded text-xs text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Pilih produk..."}),(function(e){let s=_[e]||"",t=d;if(s.trim()&&(t=t.filter(e=>e.product_name.toLowerCase().includes(s.toLowerCase())||e.sku_code.toLowerCase().includes(s.toLowerCase()))),x.length>0){let e=new Set(x.map(e=>e.sku_code));return t.sort((s,t)=>{let r=e.has(s.sku_code),a=e.has(t.sku_code);if(r&&!a)return -1;if(!r&&a)return 1;if(r&&a){var l,n;return((null===(l=x.find(e=>e.sku_code===s.sku_code))||void 0===l?void 0:l.priority)||999)-((null===(n=x.find(e=>e.sku_code===t.sku_code))||void 0===n?void 0:n.priority)||999)}return s.product_name.localeCompare(t.product_name)})}return t})(s).map(e=>(0,r.jsxs)("option",{value:e.id,children:[eu(e.sku_code)?"[MSL] ":"",e.sku_code," - ",e.product_name]},e.id))]})]}),(0,r.jsx)("div",{className:"col-span-2",children:(0,r.jsx)("input",{type:"number",min:"1",value:e.quantity,onChange:e=>en(s,"quantity",parseInt(e.target.value)||0),placeholder:"Qty",className:"w-full p-2 border border-gray-300 rounded text-sm text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})}),(0,r.jsx)("div",{className:"col-span-2",children:(0,r.jsx)("input",{type:"number",step:"0.01",min:"0",value:e.unit_price,onChange:e=>en(s,"unit_price",parseFloat(e.target.value)||0),placeholder:"Harga",className:"w-full p-2 border border-gray-300 rounded text-sm text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})}),(0,r.jsx)("div",{className:"col-span-2",children:(0,r.jsx)("input",{type:"number",min:"0",max:"100",value:e.discount_percentage,onChange:e=>en(s,"discount_percentage",parseFloat(e.target.value)||0),placeholder:"Disc %",className:"w-full p-2 border border-gray-300 rounded text-sm text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500"})}),(0,r.jsx)("div",{className:"col-span-1",children:(0,r.jsx)("button",{type:"button",onClick:()=>el(s),className:"w-full p-2 text-red-600 hover:bg-red-50 rounded transition-colors",children:(0,r.jsx)(N.Z,{className:"h-4 w-4"})})})]},s)),W.length>0&&(0,r.jsx)("div",{className:"text-right",children:(0,r.jsxs)("span",{className:"text-lg font-semibold text-gray-900",children:["Total: Rp ",W.reduce((e,s)=>e+ea(s),0).toLocaleString("id-ID")]})})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Catatan (Opsional)"}),(0,r.jsx)("textarea",{value:z,onChange:e=>Y(e.target.value),rows:3,className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-gray-900",placeholder:"Tambahkan catatan kunjungan..."})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{type:"button",onClick:t,className:"px-3 py-2 text-sm text-gray-600 bg-gray-100 rounded hover:bg-gray-200 transition-colors",children:"Batal"}),(0,r.jsx)("button",{type:"submit",disabled:J||!A&&!U||U&&(!Z.store_name||!Z.store_code||!Z.category)||!K&&!G,className:"px-3 py-2 text-sm bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:J?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),(0,r.jsx)("span",{children:"Menyimpan..."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(S.Z,{className:"h-3 w-3"}),(0,r.jsx)("span",{children:"Simpan Kunjungan"})]})})]})]})]})})}function E(e){let{user:s,userRole:t,selectedDate:l,onClose:n}=e,[i,d]=(0,a.useState)({visits:[],totalVisits:0,totalEC:0,totalSales:0,mslAchievement:0}),[c,x]=(0,a.useState)(!0),[m,u]=(0,a.useState)(l);(0,a.useEffect)(()=>{g()},[m,s.id,t]);let g=async()=>{x(!0);try{let e=o.from("visits").select("\n          id,\n          has_order,\n          stores!inner(store_name, store_code, category),\n          visit_orders(\n            quantity,\n            line_total,\n            products!inner(sku_code, product_name)\n          )\n        ").eq("visit_date",m);"admin"!==t&&(e=e.eq("salesman_id",s.id));let{data:r,error:a}=await e;if(a)throw a;let l=(r||[]).map(e=>{var s;let t=(null===(s=e.visit_orders)||void 0===s?void 0:s.map(e=>({sku_code:e.products.sku_code,product_name:e.products.product_name,quantity:e.quantity,line_total:e.line_total})))||[],r=t.reduce((e,s)=>e+s.line_total,0);return{id:e.id,store_name:e.stores.store_name,store_code:e.stores.store_code,store_category:e.stores.category,has_order:e.has_order,total_amount:r,order_items:t}}),n=l.length,i=l.filter(e=>e.has_order).length,c=l.reduce((e,s)=>e+s.total_amount,0),x=0,{data:u}=await o.from("msl_items").select("category, sku_code"),g=(u||[]).reduce((e,s)=>(e[s.category]||(e[s.category]=new Set),e[s.category].add(s.sku_code),e),{});if(Object.keys(g).length>0&&l.length>0){let e=0,s=0,t=l.reduce((e,s)=>{let t="".concat(s.store_name,"-").concat(s.store_code);return e[t]||(e[t]={category:s.store_category,orderItems:[]}),e[t].orderItems.push(...s.order_items),e},{});for(let[r,a]of Object.entries(t)){let t=g[a.category];if(!t||0===t.size)continue;let r=new Set;a.orderItems.forEach(e=>{e.sku_code&&r.add(e.sku_code)});let l=Array.from(r).filter(e=>t.has(e)).length/t.size*100;e+=l,s++}x=s>0?e/s:0}d({visits:l,totalVisits:n,totalEC:i,totalSales:c,mslAchievement:x})}catch(e){console.error("Error fetching daily data:",e),d({visits:[],totalVisits:0,totalEC:0,totalSales:0,mslAchievement:0})}finally{x(!1)}};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"h-10 w-10 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(S.Z,{className:"h-5 w-5 text-blue-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Rekap Harian"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:new Date(m).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]}),(0,r.jsx)("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,r.jsx)(N.Z,{className:"h-5 w-5 text-gray-500"})})]}),(0,r.jsxs)("div",{className:"p-6 space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih Tanggal"}),(0,r.jsx)("input",{type:"date",value:m,onChange:e=>u(e.target.value),className:"p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),c?(0,r.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[(0,r.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(p.Z,{className:"h-5 w-5 text-blue-600"}),(0,r.jsx)("span",{className:"text-sm font-medium text-blue-900",children:"Total Call"})]}),(0,r.jsx)("p",{className:"text-2xl font-bold text-blue-900 mt-1",children:i.totalVisits})]}),(0,r.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(_.Z,{className:"h-5 w-5 text-green-600"}),(0,r.jsx)("span",{className:"text-sm font-medium text-green-900",children:"Total EC"})]}),(0,r.jsx)("p",{className:"text-2xl font-bold text-green-900 mt-1",children:i.totalEC})]}),(0,r.jsxs)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(b.Z,{className:"h-5 w-5 text-purple-600"}),(0,r.jsx)("span",{className:"text-sm font-medium text-purple-900",children:"EC Rate"})]}),(0,r.jsxs)("p",{className:"text-2xl font-bold text-purple-900 mt-1",children:[i.totalVisits>0?Math.round(i.totalEC/i.totalVisits*100):0,"%"]})]}),(0,r.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(k.Z,{className:"h-5 w-5 text-orange-600"}),(0,r.jsx)("span",{className:"text-sm font-medium text-orange-900",children:"Total Penjualan"})]}),(0,r.jsxs)("p",{className:"text-2xl font-bold text-orange-900 mt-1",children:["Rp ",i.totalSales.toLocaleString("id-ID")]})]}),(0,r.jsxs)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(b.Z,{className:"h-5 w-5 text-purple-600"}),(0,r.jsx)("span",{className:"text-sm font-medium text-purple-900",children:"MSL Achievement"})]}),(0,r.jsxs)("p",{className:"text-2xl font-bold text-purple-900 mt-1",children:[i.mslAchievement.toFixed(1),"%"]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Detail Kunjungan"}),0===i.visits.length?(0,r.jsx)("div",{className:"text-center py-8 text-gray-500",children:"Tidak ada kunjungan pada tanggal ini"}):(0,r.jsx)("div",{className:"space-y-4",children:i.visits.map(e=>(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold text-gray-900",children:e.store_name}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Kode: ",e.store_code]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(e.has_order?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.has_order?"Ada Order":"Tidak Order"}),e.has_order&&(0,r.jsxs)("p",{className:"text-lg font-bold text-gray-900 mt-1",children:["Rp ",e.total_amount.toLocaleString("id-ID")]})]})]}),e.order_items.length>0&&(0,r.jsxs)("div",{className:"border-t border-gray-200 pt-3",children:[(0,r.jsx)("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Produk yang Dibeli:"}),(0,r.jsx)("div",{className:"space-y-1",children:e.order_items.map((e,s)=>(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsxs)("span",{className:"text-gray-600",children:[e.sku_code," - ",e.product_name," (x",e.quantity,")"]}),(0,r.jsxs)("span",{className:"font-medium text-gray-900",children:["Rp ",e.line_total.toLocaleString("id-ID")]})]},s))})]})]},e.id))})]})]})]})]})})}function T(e){var s;let{user:t,userRole:l}=e,[n,i]=(0,a.useState)({totalCall:0,totalEC:0,mslAchievement:0,monthlySales:0}),[d,c]=(0,a.useState)(!0),[x,m]=(0,a.useState)(!1),[g,h]=(0,a.useState)(!1),f=new Date().toISOString().split("T")[0];(0,a.useEffect)(()=>{j()},[t.id,l]);let j=async()=>{c(!0);try{let e=o.from("visits").select("id, has_order").eq("visit_date",f);"admin"!==l&&(e=e.eq("salesman_id",t.id));let{data:s}=await e,r=(null==s?void 0:s.length)||0,a=(null==s?void 0:s.filter(e=>e.has_order).length)||0,n=0,{data:d}=await o.from("msl_items").select("category, sku_code"),c=(d||[]).reduce((e,s)=>(e[s.category]||(e[s.category]=new Set),e[s.category].add(s.sku_code),e),{});if(Object.keys(c).length>0){let e=o.from("stores").select("id, category");"admin"!==l&&(e=e.eq("created_by",t.id));let{data:s}=await e;if(s&&s.length>0){let e=0,r=0;for(let a of s){let s=c[a.category];if(!s||0===s.size)continue;let n=o.from("visits").select("\n                visit_orders!inner(\n                  products!inner(sku_code)\n                )\n              ").eq("store_id",a.id).eq("visit_date",f).eq("has_order",!0);"admin"!==l&&(n=n.eq("salesman_id",t.id));let{data:i}=await n,d=new Set;null==i||i.forEach(e=>{var s;null===(s=e.visit_orders)||void 0===s||s.forEach(e=>{var s;(null===(s=e.products)||void 0===s?void 0:s.sku_code)&&d.add(e.products.sku_code)})});let x=Array.from(d).filter(e=>s.has(e)).length/s.size*100;e+=x,r++}n=r>0?e/r:0}}let x=new Date().toISOString().slice(0,7),m=o.from("visits").select("\n          visit_orders(line_total)\n        ").gte("visit_date","".concat(x,"-01")).lte("visit_date","".concat(x,"-31"));"admin"!==l&&(m=m.eq("salesman_id",t.id));let{data:u}=await m,g=(null==u?void 0:u.reduce((e,s)=>{var t;return e+((null===(t=s.visit_orders)||void 0===t?void 0:t.reduce((e,s)=>e+s.line_total,0))||0)},0))||0;i({totalCall:r,totalEC:a,mslAchievement:n,monthlySales:g})}catch(e){console.error("Error fetching dashboard stats:",e),i({totalCall:0,totalEC:0,mslAchievement:0,monthlySales:0})}finally{c(!1)}},y=new Date().toLocaleDateString("en-US",{month:"long"});return(0,r.jsxs)("div",{className:"p-6 space-y-6",children:[(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-2xl font-bold text-gray-900",children:["Welcome back, ",null===(s=t.email)||void 0===s?void 0:s.split("@")[0],"!"]}),(0,r.jsx)("p",{className:"text-gray-600 mt-1",children:"Here's your daily performance summary."})]}),(0,r.jsx)("div",{className:"hidden sm:block",children:(0,r.jsx)("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 text-white px-4 py-2 rounded-lg text-sm font-medium",children:new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Call"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:d?"...":n.totalCall})]}),(0,r.jsx)("div",{className:"h-12 w-12 bg-blue-50 rounded-lg flex items-center justify-center",children:(0,r.jsx)(p.Z,{className:"h-6 w-6 text-blue-600"})})]}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"Kunjungan hari ini"})})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total EC"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:d?"...":n.totalEC})]}),(0,r.jsx)("div",{className:"h-12 w-12 bg-green-50 rounded-lg flex items-center justify-center",children:(0,r.jsx)(_.Z,{className:"h-6 w-6 text-green-600"})})]}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:["Effective Call (",n.totalCall>0?Math.round(n.totalEC/n.totalCall*100):0,"%)"]})})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"MSL Achievement"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:d?"...":"".concat(n.mslAchievement.toFixed(1),"%")})]}),(0,r.jsx)("div",{className:"h-12 w-12 bg-purple-50 rounded-lg flex items-center justify-center",children:(0,r.jsx)(b.Z,{className:"h-6 w-6 text-purple-600"})})]}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"Rata-rata pencapaian MSL hari ini"})})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"text-sm font-medium text-gray-600",children:["Total Sales [",y,"]"]}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:d?"...":"Rp ".concat(n.monthlySales.toLocaleString("id-ID"))})]}),(0,r.jsx)("div",{className:"h-12 w-12 bg-orange-50 rounded-lg flex items-center justify-center",children:(0,r.jsx)(k.Z,{className:"h-6 w-6 text-orange-600"})})]}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"Penjualan bulan ini"})})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("button",{onClick:()=>m(!0),className:"w-full text-left p-3 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"h-8 w-8 bg-green-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(S.Z,{className:"h-4 w-4 text-green-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-gray-900",children:"Tambah Kunjungan Toko"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Catat kunjungan dan pesanan hari ini"})]})]})}),(0,r.jsx)("button",{onClick:()=>h(!0),className:"w-full text-left p-3 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"h-8 w-8 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(u.Z,{className:"h-4 w-4 text-blue-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-gray-900",children:"Lihat Rekap Harian"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Detail kunjungan dan penjualan hari ini"})]})]})}),(0,r.jsx)("button",{className:"w-full text-left p-3 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"h-8 w-8 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(b.Z,{className:"h-4 w-4 text-purple-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-gray-900",children:"View Products"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Browse product catalog"})]})]})})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Activity"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)("div",{className:"h-2 w-2 bg-green-500 rounded-full mt-2"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Store visit completed"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Beauty Corner - 2 hours ago"})]})]}),(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)("div",{className:"h-2 w-2 bg-blue-500 rounded-full mt-2"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"New order placed"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Glamour Boutique - 4 hours ago"})]})]}),(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)("div",{className:"h-2 w-2 bg-orange-500 rounded-full mt-2"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Product updated"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"L'Or\xe9al Paris Mascara - Yesterday"})]})]})]})]})]}),x&&(0,r.jsx)(O,{user:t,onClose:()=>m(!1),onSuccess:()=>{j()}}),g&&(0,r.jsx)(E,{user:t,userRole:l,selectedDate:f,onClose:()=>h(!1)})]})}var R=t(3927),A=t(3818),L=t(8012),M=t(8880);function P(e){let{user:s,onClose:t,onSuccess:l}=e,[n,i]=(0,a.useState)({store_name:"",store_code:"",category:"",address:"",gmaps_link:"",route:"A",phone:"",average_order_value:"",order_frequency:"",key_contact:"",notes:"",recommended_skus:[]}),[d,c]=(0,a.useState)([]),[x,m]=(0,a.useState)([]),[u,g]=(0,a.useState)([]),[h,b]=(0,a.useState)(!1),[f,j]=(0,a.useState)(!0);(0,a.useEffect)(()=>{y(),v()},[]);let y=async()=>{try{let{data:e,error:s}=await o.from("products").select("id, sku_code, product_name").eq("is_active",!0).order("sku_code");if(s)throw s;c(e||[])}catch(e){console.error("Error fetching products:",e),c([])}finally{j(!1)}},v=async()=>{try{let e=o.from("stores").select("category, route"),{data:s,error:t}=await e;if(t)throw t;let r=Array.from(new Set((s||[]).map(e=>e.category).filter(Boolean))),a=Array.from(new Set((s||[]).map(e=>e.route).filter(Boolean)));m(r.sort()),g(a.sort()),r.length>0&&!n.category&&i(e=>({...e,category:r[0]})),a.length>0&&i(e=>({...e,route:a[0]}))}catch(e){console.error("Error fetching categories and routes:",e)}},w=(e,s)=>{i(t=>({...t,[e]:s}))},_=e=>{i(s=>({...s,recommended_skus:s.recommended_skus.includes(e)?s.recommended_skus.filter(s=>s!==e):[...s.recommended_skus,e]}))},k=async e=>{if(e.preventDefault(),n.store_name&&n.store_code){b(!0);try{let{error:e}=await o.from("stores").insert({store_name:n.store_name,store_code:n.store_code,category:n.category,address:n.address,gmaps_link:n.gmaps_link||null,route:n.route,phone:n.phone||null,average_order_value:n.average_order_value?parseFloat(n.average_order_value):0,order_frequency:n.order_frequency||null,key_contact:n.key_contact||null,notes:n.notes||null,created_by:s.id});if(e)throw e;l(),t()}catch(e){console.error("Error creating store:",e),alert("Gagal menyimpan toko. Silakan coba lagi.")}finally{b(!1)}}};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"h-10 w-10 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(p.Z,{className:"h-5 w-5 text-blue-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Tambah Toko Baru"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Daftarkan toko baru ke dalam sistem"})]})]}),(0,r.jsx)("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,r.jsx)(N.Z,{className:"h-5 w-5 text-gray-500"})})]}),(0,r.jsxs)("form",{onSubmit:k,className:"p-6 space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nama Toko *"}),(0,r.jsx)("input",{type:"text",value:n.store_name,onChange:e=>w("store_name",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900",placeholder:"Contoh: Beauty Corner",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kode Toko *"}),(0,r.jsx)("input",{type:"text",value:n.store_code,onChange:e=>w("store_code",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900",placeholder:"Contoh: BC001",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kategori Toko *"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("select",{value:n.category,onChange:e=>w("category",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900",required:!0,children:[(0,r.jsx)("option",{value:"",children:"Pilih kategori..."}),x.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]}),(0,r.jsx)("input",{type:"text",value:n.category,onChange:e=>w("category",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900",placeholder:"Atau ketik kategori baru..."})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Alamat"}),(0,r.jsx)("textarea",{value:n.address,onChange:e=>w("address",e.target.value),rows:2,className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900",placeholder:"Alamat lengkap toko"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Link Google Maps"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(L.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,r.jsx)("input",{type:"url",value:n.gmaps_link,onChange:e=>w("gmaps_link",e.target.value),className:"w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900",placeholder:"https://maps.google.com/..."})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Route"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("select",{value:n.route,onChange:e=>w("route",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900",children:[(0,r.jsx)("option",{value:"",children:"Pilih route..."}),u.map(e=>(0,r.jsxs)("option",{value:e,children:["Route ",e]},e))]}),(0,r.jsx)("input",{type:"text",value:n.route,onChange:e=>w("route",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900",placeholder:"Atau ketik route baru..."})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Telepon"}),(0,r.jsx)("input",{type:"tel",value:n.phone,onChange:e=>w("phone",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900",placeholder:"+62 xxx xxx xxxx"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rata-rata Order Value"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-sm text-gray-400",children:"Rp"}),(0,r.jsx)("input",{type:"number",step:"0.01",min:"0",value:n.average_order_value,onChange:e=>w("average_order_value",e.target.value),className:"w-full pl-8 pr-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900",placeholder:"0.00"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Frekuensi Order"}),(0,r.jsxs)("select",{value:n.order_frequency,onChange:e=>w("order_frequency",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900",children:[(0,r.jsx)("option",{value:"",children:"Pilih frekuensi..."}),(0,r.jsx)("option",{value:"Weekly",children:"Mingguan"}),(0,r.jsx)("option",{value:"Bi-weekly",children:"Dua Minggu"}),(0,r.jsx)("option",{value:"Monthly",children:"Bulanan"}),(0,r.jsx)("option",{value:"Quarterly",children:"Tiga Bulan"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kontak Utama"}),(0,r.jsx)("input",{type:"text",value:n.key_contact,onChange:e=>w("key_contact",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900",placeholder:"Nama kontak utama"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rekomendasi SKU"}),f?(0,r.jsx)("div",{className:"p-3 text-gray-500",children:"Memuat produk..."}):(0,r.jsx)("div",{className:"max-h-32 overflow-y-auto border border-gray-300 rounded-lg p-3 space-y-2",children:d.map(e=>(0,r.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:n.recommended_skus.includes(e.id),onChange:()=>_(e.id),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,r.jsxs)("span",{className:"text-sm text-gray-700",children:[e.sku_code," - ",e.product_name]})]},e.id))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Catatan"}),(0,r.jsx)("textarea",{value:n.notes,onChange:e=>w("notes",e.target.value),rows:3,className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900",placeholder:"Catatan tambahan tentang toko..."})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Batal"}),(0,r.jsx)("button",{type:"submit",disabled:h||!n.store_name||!n.store_code,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:h?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,r.jsx)("span",{children:"Menyimpan..."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:"Simpan Toko"})]})})]})]})]})})}var U=t(7928),D=t(1146),Z=t(5255),I=t(5361);function V(e){let{user:s,onClose:t,onSuccess:l}=e,[n,i]=(0,a.useState)(null),[d,c]=(0,a.useState)([]),[x,m]=(0,a.useState)(!1),[u,g]=(0,a.useState)(!1),[h,p]=(0,a.useState)(null),b=async()=>{if(!n)return;let e=(await n.text()).trim().split("\n");if(e.length<2){alert("CSV file must have at least a header row and one data row");return}let t=e[0].split(",").map(e=>e.trim().toUpperCase()),r=["KODE_TOKO","NAMA_TOKO","KATEGORI"].filter(e=>!t.includes(e));if(r.length>0){alert("Missing required columns: ".concat(r.join(", ")));return}let a=t.indexOf("KODE_TOKO"),l=t.indexOf("NAMA_TOKO"),i=t.indexOf("KATEGORI"),d=t.indexOf("ALAMAT"),x=t.indexOf("GOOGLE_MAPS"),u=t.indexOf("ROUTE"),g=t.indexOf("TELEPON"),h=t.indexOf("AVG_ORDER_VALUE"),p=t.indexOf("FREKUENSI_ORDER"),b=t.indexOf("KONTAK_UTAMA"),f=t.indexOf("CATATAN"),{data:j}=await o.from("stores").select("store_code").eq("created_by",s.id),y=new Set((null==j?void 0:j.map(e=>e.store_code))||[]),N=new Set,v=[];for(let s=1;s<e.length;s++){let t=e[s].split(",").map(e=>e.trim().replace(/^"|"$/g,"")),r=t[a]||"",n=t[l]||"",o=t[i]||"",c=t[d]||"",m=t[x]||"",j=t[u]||"A",w=t[g]||"",_=t[h]||"0",k=t[p]||"",S=t[b]||"",C=t[f]||"",O=!0,E="";if(r&&n&&o?N.has(r)?(O=!1,E="Row ".concat(s+1,": Duplicate store code in file")):N.add(r):(O=!1,E="Row ".concat(s+1,": Missing required fields (KODE_TOKO, NAMA_TOKO, KATEGORI)")),O&&_&&"0"!==_){let e=parseFloat(_);(isNaN(e)||e<0)&&(O=!1,E="Row ".concat(s+1,": Invalid average order value"))}v.push({kode_toko:r,nama_toko:n,kategori:o,alamat:c,google_maps:m,route:j,telepon:w,avg_order_value:_,frekuensi_order:k,kontak_utama:S,catatan:C,isValid:O,error:E,action:y.has(r)?"UPDATE":"INSERT"})}c(v),m(!0)},f=async()=>{g(!0);let e=d.filter(e=>e.isValid),r=0,a=0,n=0;for(let t of e)try{let e={store_code:t.kode_toko,store_name:t.nama_toko,category:t.kategori,address:t.alamat||"",gmaps_link:t.google_maps||null,route:t.route||"A",phone:t.telepon||null,average_order_value:t.avg_order_value?parseFloat(t.avg_order_value):0,order_frequency:t.frekuensi_order||null,key_contact:t.kontak_utama||null,notes:t.catatan||null,created_by:s.id};if("UPDATE"===t.action){let{error:r}=await o.from("stores").update({store_name:e.store_name,category:e.category,address:e.address,gmaps_link:e.gmaps_link,route:e.route,phone:e.phone,average_order_value:e.average_order_value,order_frequency:e.order_frequency,key_contact:e.key_contact,notes:e.notes}).eq("store_code",t.kode_toko).eq("created_by",s.id);r?(console.error("Error updating store:",r),n++):a++}else{let{error:s}=await o.from("stores").insert(e);s?(console.error("Error inserting store:",s),n++):r++}}catch(e){console.error("Error processing store:",e),n++}p({added:r,updated:a,failed:n}),g(!1),(r>0||a>0)&&setTimeout(()=>{l(),t()},2e3)};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"h-10 w-10 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(R.Z,{className:"h-5 w-5 text-blue-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Import Stores from CSV"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Bulk upload store data from CSV file"})]})]}),(0,r.jsx)("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,r.jsx)(N.Z,{className:"h-5 w-5 text-gray-500"})})]}),(0,r.jsx)("div",{className:"p-6 space-y-6",children:x?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upload Preview"}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[(0,r.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(Z.Z,{className:"h-5 w-5 text-green-600"}),(0,r.jsxs)("span",{className:"font-medium text-green-900",children:[d.filter(e=>e.isValid&&"INSERT"===e.action).length," New Stores"]})]})}),(0,r.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(Z.Z,{className:"h-5 w-5 text-blue-600"}),(0,r.jsxs)("span",{className:"font-medium text-blue-900",children:[d.filter(e=>e.isValid&&"UPDATE"===e.action).length," Updates"]})]})}),(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(I.Z,{className:"h-5 w-5 text-red-600"}),(0,r.jsxs)("span",{className:"font-medium text-red-900",children:[d.filter(e=>!e.isValid).length," Errors"]})]})})]}),(0,r.jsx)("div",{className:"max-h-64 overflow-y-auto border border-gray-200 rounded-lg",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"bg-gray-50 sticky top-0",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"text-left p-3 font-medium text-gray-600",children:"Status"}),(0,r.jsx)("th",{className:"text-left p-3 font-medium text-gray-600",children:"Action"}),(0,r.jsx)("th",{className:"text-left p-3 font-medium text-gray-600",children:"Store Code"}),(0,r.jsx)("th",{className:"text-left p-3 font-medium text-gray-600",children:"Store Name"}),(0,r.jsx)("th",{className:"text-left p-3 font-medium text-gray-600",children:"Category"}),(0,r.jsx)("th",{className:"text-left p-3 font-medium text-gray-600",children:"Route"}),(0,r.jsx)("th",{className:"text-left p-3 font-medium text-gray-600",children:"Contact"})]})}),(0,r.jsx)("tbody",{children:d.map((e,s)=>(0,r.jsxs)("tr",{className:"border-t border-gray-100 ".concat(e.isValid?"":"bg-red-50"),children:[(0,r.jsx)("td",{className:"p-3",children:e.isValid?(0,r.jsx)(Z.Z,{className:"h-4 w-4 text-green-600"}):(0,r.jsx)(I.Z,{className:"h-4 w-4 text-red-600"})}),(0,r.jsx)("td",{className:"p-3",children:e.isValid?(0,r.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("INSERT"===e.action?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"),children:e.action}):(0,r.jsx)("span",{className:"text-red-600 text-xs",children:e.error})}),(0,r.jsx)("td",{className:"p-3 font-mono",children:e.kode_toko}),(0,r.jsx)("td",{className:"p-3 text-gray-900",children:e.nama_toko}),(0,r.jsx)("td",{className:"p-3",children:(0,r.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("GT PROV"===e.kategori?"bg-purple-100 text-purple-800":"GT Wholesale"===e.kategori?"bg-orange-100 text-orange-800":"bg-green-100 text-green-800"),children:e.kategori})}),(0,r.jsx)("td",{className:"p-3 text-gray-900",children:e.route}),(0,r.jsx)("td",{className:"p-3 text-gray-900",children:e.kontak_utama})]},s))})]})})]}),h&&(0,r.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(Z.Z,{className:"h-5 w-5 text-green-600"}),(0,r.jsxs)("span",{className:"font-medium text-green-900",children:["Upload complete! ",h.added," added, ",h.updated," updated, ",h.failed," failed"]})]})}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{onClick:()=>m(!1),disabled:u,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 disabled:opacity-50 transition-colors",children:"Back"}),(0,r.jsx)("button",{onClick:f,disabled:u||0===d.filter(e=>e.isValid).length,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:u?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,r.jsx)("span",{children:"Uploading..."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(R.Z,{className:"h-4 w-4"}),(0,r.jsxs)("span",{children:["Confirm Upload (",d.filter(e=>e.isValid).length," stores)"]})]})})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)(U.Z,{className:"h-5 w-5 text-blue-600 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-blue-900 mb-2",children:"CSV Format Required"}),(0,r.jsx)("p",{className:"text-sm text-blue-700 mb-3",children:"Required columns: KODE_TOKO, NAMA_TOKO, KATEGORI"}),(0,r.jsx)("p",{className:"text-sm text-blue-700 mb-3",children:"Optional columns: ALAMAT, GOOGLE_MAPS, ROUTE, TELEPON, AVG_ORDER_VALUE, FREKUENSI_ORDER, KONTAK_UTAMA, CATATAN"}),(0,r.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1",children:[(0,r.jsx)("li",{children:" First row must be headers"}),(0,r.jsx)("li",{children:" Use comma as delimiter"}),(0,r.jsx)("li",{children:" Categories: GT PROV, GT Wholesale, GT Small Cosmetics"}),(0,r.jsx)("li",{children:" Routes: A, B, C, D"}),(0,r.jsx)("li",{children:" Existing store codes will be updated, new codes will be added"})]})]})]}),(0,r.jsxs)("button",{onClick:()=>{let e=new Blob(['KODE_TOKO,NAMA_TOKO,KATEGORI,ALAMAT,GOOGLE_MAPS,ROUTE,TELEPON,AVG_ORDER_VALUE,FREKUENSI_ORDER,KONTAK_UTAMA,CATATAN\nBC001,Beauty Corner,GT Small Cosmetics,"Jl. Sudirman No. 123, Jakarta",https://maps.google.com/...,A,+62812345678,750000,Monthly,Sari Dewi,Toko kosmetik terpercaya\nWH002,Wholesale Cantik,GT Wholesale,"Jl. Gajah Mada No. 456, Surabaya",,B,+62823456789,1200000,Bi-weekly,Budi Santoso,Distributor besar\nPROV003,Provinsi Beauty,GT PROV,"Jl. Diponegoro No. 789, Bandung",https://maps.google.com/...,C,+62834567890,2000000,Weekly,Maya Sari,Outlet provinsi utama'],{type:"text/csv"}),s=window.URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download="store_template.csv",document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(s)},className:"inline-flex items-center px-3 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,r.jsx)(D.Z,{className:"h-4 w-4 mr-1"}),"Template"]})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select CSV File"}),(0,r.jsx)("input",{type:"file",accept:".csv",onChange:e=>{var s;let t=null===(s=e.target.files)||void 0===s?void 0:s[0];t&&"text/csv"===t.type?i(t):alert("Please select a valid CSV file")},className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),n&&(0,r.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["Selected: ",n.name," (",(n.size/1024).toFixed(1)," KB)"]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{onClick:t,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,r.jsx)("button",{onClick:b,disabled:!n,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Parse CSV"})]})]})})]})})}function q(e){let{user:s,userRole:t,setActiveTab:l}=e,[n,i]=(0,a.useState)([]),[d,c]=(0,a.useState)([]),[x,m]=(0,a.useState)([]),[u,g]=(0,a.useState)([]),[h,b]=(0,a.useState)(!0),[f,j]=(0,a.useState)(""),[y,N]=(0,a.useState)(""),[v,w]=(0,a.useState)(""),[_,k]=(0,a.useState)(!1),[S,O]=(0,a.useState)(!1),[E,T]=(0,a.useState)({}),[U,D]=(0,a.useState)(null);(0,a.useEffect)(()=>{Z(),I(),q()},[]),(0,a.useEffect)(()=>{F()},[n,f,y,v]);let Z=async()=>{try{let e=o.from("stores").select("*").order("store_name");"admin"!==t&&(e=e.eq("created_by",s.id));let{data:r,error:a}=await e;if(a)throw a;i(r||[]),c(r||[])}catch(e){console.error("Error fetching stores:",e),i([]),c([])}finally{b(!1)}},I=async()=>{try{let e=o.from("stores").select("category, route");"admin"!==t&&(e=e.eq("created_by",s.id));let{data:r,error:a}=await e;if(a)throw a;let l=[...new Set((r||[]).map(e=>e.category).filter(Boolean))],n=[...new Set((r||[]).map(e=>e.route).filter(Boolean))];m(l.sort()),g(n.sort())}catch(e){console.error("Error fetching categories and routes:",e)}},q=async()=>{try{let{data:e,error:s}=await o.from("msl_items").select("category, sku_code, product_name, priority").order("category").order("priority");if(s)throw s;let t=(e||[]).reduce((e,s)=>(e[s.category]||(e[s.category]=[]),e[s.category].push(s),e),{});T(t)}catch(e){console.error("Error fetching MSL data:",e),T({})}},F=()=>{let e=n;f&&(e=e.filter(e=>e.store_name.toLowerCase().includes(f.toLowerCase())||e.store_code.toLowerCase().includes(f.toLowerCase())||e.address.toLowerCase().includes(f.toLowerCase()))),y&&(e=e.filter(e=>e.route===y)),v&&(e=e.filter(e=>e.category===v)),c(e)},G=e=>({"GT PROV":{bg:"bg-purple-100",text:"text-purple-800",border:"border-purple-200"},"GT Wholesale":{bg:"bg-orange-100",text:"text-orange-800",border:"border-orange-200"},"GT Small Cosmetics":{bg:"bg-green-100",text:"text-green-800",border:"border-green-200"}})[e]||{bg:"bg-gray-100",text:"text-gray-800",border:"border-gray-200"},B=e=>{var s;return(null===(s=E[e])||void 0===s?void 0:s.length)||0},z=function(e){var s;let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return(null===(s=E[e])||void 0===s?void 0:s.slice(0,t))||[]};return(0,r.jsxs)("div",{className:"p-6 space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Store Management"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Manage your retail locations and client relationships"})]}),(0,r.jsxs)("button",{onClick:()=>O(!0),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,r.jsx)(R.Z,{className:"h-4 w-4 mr-2"}),"Import Stores"]}),(0,r.jsxs)("button",{onClick:()=>k(!0),className:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-lg hover:from-orange-600 hover:to-red-600 transition-all duration-200 shadow-sm",children:[(0,r.jsx)(C.Z,{className:"h-4 w-4 mr-2"}),"Add Store"]})]}),(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,r.jsxs)("div",{className:"flex-1 relative",children:[(0,r.jsx)(A.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,r.jsx)("input",{type:"text",value:f,onChange:e=>j(e.target.value),placeholder:"Search stores...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent text-gray-900"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("select",{value:v,onChange:e=>w(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent text-gray-900",children:[(0,r.jsx)("option",{value:"",children:"All Categories"}),x.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]}),(0,r.jsxs)("select",{value:y,onChange:e=>N(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent text-gray-900",children:[(0,r.jsx)("option",{value:"",children:"All Routes"}),u.map(e=>(0,r.jsxs)("option",{value:e,children:["Route ",e]},e))]})]})]})}),h?(0,r.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"})}):(0,r.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:0===d.length?(0,r.jsx)("div",{className:"col-span-full text-center py-12 text-gray-500",children:f||y||v?"Tidak ada toko yang sesuai dengan filter":"Belum ada toko. Tambahkan toko pertama Anda!"}):d.map(e=>(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow",children:[(0,r.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"h-10 w-10 bg-orange-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(p.Z,{className:"h-5 w-5 text-orange-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900",children:e.store_name}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ".concat(G(e.category).bg," ").concat(G(e.category).text),children:e.category}),(0,r.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:["Route ",e.route]})]})]})]})}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,r.jsx)(L.Z,{className:"h-4 w-4 text-gray-400 mt-0.5"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.address})]}),e.phone&&(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(M.Z,{className:"h-4 w-4 text-gray-400"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.phone})]}),(0,r.jsx)("div",{className:"pt-2 border-t border-gray-100",children:(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsx)("p",{className:"text-gray-500 text-xs",children:"MSL Recommendations"}),(0,r.jsxs)("p",{className:"font-medium text-gray-900",children:[B(e.category)," recommended SKUs"]})]})}),(0,r.jsxs)("div",{className:"pt-2 flex space-x-2",children:[(0,r.jsx)("button",{className:"flex-1 px-3 py-2 text-sm font-medium text-blue-700 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors",title:"View MSL Guide for ".concat(e.category),onClick:()=>{l("msl"),setTimeout(()=>{let s=new CustomEvent("setMSLCategory",{detail:e.category});window.dispatchEvent(s)},100)},children:"MSL Guide"}),(0,r.jsx)("button",{className:"flex-1 px-3 py-2 text-sm font-medium text-orange-700 bg-orange-50 rounded-lg hover:bg-orange-100 transition-colors",onClick:()=>{e.gmaps_link?window.open(e.gmaps_link,"_blank"):alert("Google Maps link not available for this store")},children:"Visit"}),"admin"===t&&(0,r.jsx)("button",{className:"flex-1 px-3 py-2 text-sm font-medium text-gray-700 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",onClick:()=>D(e),children:"Edit"})]}),B(e.category)>0&&(0,r.jsxs)("div",{className:"pt-3 border-t border-gray-100 mt-3",children:[(0,r.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:"Top MSL Items:"}),(0,r.jsxs)("div",{className:"space-y-1",children:[z(e.category,5).map((e,s)=>(0,r.jsxs)("div",{className:"flex items-center text-xs text-gray-600",children:[(0,r.jsx)("span",{className:"w-4 h-4 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold mr-2",children:e.priority}),(0,r.jsx)("span",{className:"font-mono mr-2 text-xs",children:e.sku_code}),(0,r.jsx)("span",{className:"truncate text-xs",children:e.product_name})]},s)),B(e.category)>5&&(0,r.jsxs)("p",{className:"text-xs text-gray-400",children:["+",B(e.category)-5," more items"]})]})]})]})]},e.id))}),U&&"admin"===t&&(0,r.jsx)(K,{store:U,onClose:()=>D(null),onSuccess:()=>{Z(),D(null)}}),_&&(0,r.jsx)(P,{user:s,onClose:()=>k(!1),onSuccess:()=>{Z(),I()}}),S&&(0,r.jsx)(V,{user:s,onClose:()=>O(!1),onSuccess:()=>{Z(),I()}})]})}function K(e){var s;let{store:t,onClose:l,onSuccess:n}=e,[i,d]=(0,a.useState)({store_name:t.store_name,store_code:t.store_code,category:t.category,address:t.address,gmaps_link:t.gmaps_link||"",route:t.route,phone:t.phone||"",average_order_value:(null===(s=t.average_order_value)||void 0===s?void 0:s.toString())||"",order_frequency:t.order_frequency||"",key_contact:t.key_contact||"",notes:t.notes||""}),[c,x]=(0,a.useState)(!1),m=(e,s)=>{d(t=>({...t,[e]:s}))},u=async e=>{e.preventDefault(),x(!0);try{let{error:e}=await o.from("stores").update({store_name:i.store_name,store_code:i.store_code,category:i.category,address:i.address,gmaps_link:i.gmaps_link||null,route:i.route,phone:i.phone||null,average_order_value:i.average_order_value?parseFloat(i.average_order_value):null,order_frequency:i.order_frequency||null,key_contact:i.key_contact||null,notes:i.notes||null}).eq("id",t.id);if(e)throw e;n()}catch(e){console.error("Error updating store:",e),alert("Failed to update store. Please try again.")}finally{x(!1)}};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Edit Store"}),(0,r.jsx)("button",{onClick:l,className:"p-2 hover:bg-gray-100 rounded-lg",children:(0,r.jsx)(N.Z,{className:"h-4 w-4 text-gray-500"})})]}),(0,r.jsxs)("form",{onSubmit:u,className:"p-4 space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Store Name"}),(0,r.jsx)("input",{type:"text",value:i.store_name,onChange:e=>m("store_name",e.target.value),className:"w-full p-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Store Code"}),(0,r.jsx)("input",{type:"text",value:i.store_code,onChange:e=>m("store_code",e.target.value),className:"w-full p-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),(0,r.jsx)("input",{type:"text",value:i.category,onChange:e=>m("category",e.target.value),className:"w-full p-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Route"}),(0,r.jsx)("input",{type:"text",value:i.route,onChange:e=>m("route",e.target.value),className:"w-full p-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900",required:!0})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),(0,r.jsx)("textarea",{value:i.address,onChange:e=>m("address",e.target.value),rows:2,className:"w-full p-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Google Maps Link"}),(0,r.jsx)("input",{type:"url",value:i.gmaps_link,onChange:e=>m("gmaps_link",e.target.value),className:"w-full p-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),(0,r.jsx)("input",{type:"tel",value:i.phone,onChange:e=>m("phone",e.target.value),className:"w-full p-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Avg Order Value"}),(0,r.jsx)("input",{type:"number",value:i.average_order_value,onChange:e=>m("average_order_value",e.target.value),className:"w-full p-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Order Frequency"}),(0,r.jsx)("input",{type:"text",value:i.order_frequency,onChange:e=>m("order_frequency",e.target.value),className:"w-full p-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Key Contact"}),(0,r.jsx)("input",{type:"text",value:i.key_contact,onChange:e=>m("key_contact",e.target.value),className:"w-full p-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),(0,r.jsx)("textarea",{value:i.notes,onChange:e=>m("notes",e.target.value),rows:2,className:"w-full p-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-gray-900"})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2 pt-4 border-t",children:[(0,r.jsx)("button",{type:"button",onClick:l,className:"px-3 py-2 text-sm text-gray-600 bg-gray-100 rounded hover:bg-gray-200",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:c,className:"px-3 py-2 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:c?"Saving...":"Save Changes"})]})]})]})})}var F=t(5847);function G(e){let{onClose:s,onSuccess:t}=e,[l,n]=(0,a.useState)(""),[i,d]=(0,a.useState)([]),[c,x]=(0,a.useState)(!1),[m,u]=(0,a.useState)(!1),[g,h]=(0,a.useState)(null),p=async()=>{u(!0);let e=i.filter(e=>e.isValid),r=0,a=0;for(let s of e)try{let{error:e}=await o.from("products").insert({sku_code:s.sku_code,product_name:s.product_name,category:s.category,unit_price:s.unit_price,is_active:!0});e?(console.error("Error inserting product:",e),a++):r++}catch(e){console.error("Error:",e),a++}h({success:r,failed:a}),u(!1),r>0&&setTimeout(()=>{t(),s()},2e3)};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"h-10 w-10 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(R.Z,{className:"h-5 w-5 text-blue-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Import Produk"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Import produk dalam jumlah banyak"})]})]}),(0,r.jsx)("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,r.jsx)(N.Z,{className:"h-5 w-5 text-gray-500"})})]}),(0,r.jsx)("div",{className:"p-6 space-y-6",children:c?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Preview Import"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,r.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(Z.Z,{className:"h-5 w-5 text-green-600"}),(0,r.jsxs)("span",{className:"font-medium text-green-900",children:[i.filter(e=>e.isValid).length," Produk Valid"]})]})}),(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(I.Z,{className:"h-5 w-5 text-red-600"}),(0,r.jsxs)("span",{className:"font-medium text-red-900",children:[i.filter(e=>!e.isValid).length," Produk Error"]})]})})]}),(0,r.jsx)("div",{className:"max-h-64 overflow-y-auto border border-gray-200 rounded-lg",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"bg-gray-50 sticky top-0",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"text-left p-3 font-medium text-gray-600",children:"Status"}),(0,r.jsx)("th",{className:"text-left p-3 font-medium text-gray-600",children:"SKU"}),(0,r.jsx)("th",{className:"text-left p-3 font-medium text-gray-600",children:"Nama Produk"}),(0,r.jsx)("th",{className:"text-left p-3 font-medium text-gray-600",children:"Kategori"}),(0,r.jsx)("th",{className:"text-left p-3 font-medium text-gray-600",children:"Harga"})]})}),(0,r.jsx)("tbody",{children:i.map((e,s)=>(0,r.jsxs)("tr",{className:"border-t border-gray-100 ".concat(e.isValid?"":"bg-red-50"),children:[(0,r.jsx)("td",{className:"p-3",children:e.isValid?(0,r.jsx)(Z.Z,{className:"h-4 w-4 text-green-600"}):(0,r.jsx)(I.Z,{className:"h-4 w-4 text-red-600"})}),(0,r.jsx)("td",{className:"p-3 font-mono",children:e.sku_code}),(0,r.jsx)("td",{className:"p-3",children:e.product_name}),(0,r.jsx)("td",{className:"p-3",children:e.category}),(0,r.jsx)("td",{className:"p-3",children:e.isValid?"$".concat(e.unit_price.toFixed(2)):e.error})]},s))})]})})]}),g&&(0,r.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(Z.Z,{className:"h-5 w-5 text-green-600"}),(0,r.jsxs)("span",{className:"font-medium text-green-900",children:["Import selesai! ",g.success," berhasil, ",g.failed," gagal"]})]})}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{onClick:()=>x(!1),disabled:m,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 disabled:opacity-50 transition-colors",children:"Kembali"}),(0,r.jsx)("button",{onClick:p,disabled:m||0===i.filter(e=>e.isValid).length,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:m?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,r.jsx)("span",{children:"Importing..."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(R.Z,{className:"h-4 w-4"}),(0,r.jsxs)("span",{children:["Import ",i.filter(e=>e.isValid).length," Produk"]})]})})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)(U.Z,{className:"h-5 w-5 text-blue-600 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-blue-900 mb-2",children:"Format yang Diperlukan"}),(0,r.jsx)("p",{className:"text-sm text-blue-700 mb-3",children:"Setiap baris harus berisi: SKU_CODE | PRODUCT_NAME | CATEGORY | PRICE"}),(0,r.jsx)("div",{className:"bg-white border border-blue-200 rounded p-3 font-mono text-sm",children:(0,r.jsx)("pre",{className:"whitespace-pre-wrap",children:"SKU001 | L'Or\xe9al Paris Voluminous Mascara | Makeup | 12.99\nSKU002 | Garnier Fructis Shampoo | Hair Care | 8.49\nSKU003 | Maybelline Foundation | Makeup | 15.99"})})]})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Daftar Produk"}),(0,r.jsx)("textarea",{value:l,onChange:e=>n(e.target.value),placeholder:"Paste daftar produk di sini...",className:"w-full h-64 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Tip: Copy dari Excel dengan format yang benar, atau ketik manual sesuai contoh di atas"})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{onClick:s,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Batal"}),(0,r.jsx)("button",{onClick:()=>{let e=l.trim().split("\n").filter(e=>e.trim()),s=[];e.forEach((e,t)=>{let r=e.split("|").map(e=>e.trim());if(4!==r.length){s.push({sku_code:"",product_name:e,category:"",unit_price:0,isValid:!1,error:"Format salah - harus 4 kolom dipisahkan dengan |"});return}let[a,l,n,i]=r,o=parseFloat(i);if(!a||!l||!n||isNaN(o)||o<=0){s.push({sku_code:a,product_name:l,category:n,unit_price:o,isValid:!1,error:"Data tidak lengkap atau harga tidak valid"});return}s.push({sku_code:a,product_name:l,category:n,unit_price:o,isValid:!0})}),d(s),x(!0)},disabled:!l.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Preview Import"})]})]})})]})})}function B(e){let{onClose:s,onSuccess:t}=e,[l,n]=(0,a.useState)(null),[i,d]=(0,a.useState)([]),[c,x]=(0,a.useState)(!1),[m,u]=(0,a.useState)(!1),[g,h]=(0,a.useState)(null),p=async()=>{if(!l)return;let e=(await l.text()).trim().split("\n");if(e.length<2){alert("CSV file must have at least a header row and one data row");return}let s=e[0].split(",").map(e=>e.trim().toUpperCase()),t=["SKU_CODE","PRODUCT_NAME","BRAND","CATEGORY","PRICE"],r=t.filter(e=>!s.includes(e));if(r.length>0){alert("Missing required columns: ".concat(r.join(", ")));return}let a=s.indexOf("SKU_CODE"),n=s.indexOf("PRODUCT_NAME"),i=s.indexOf("BRAND"),c=s.indexOf("CATEGORY"),m=s.indexOf("PRICE"),u=s.indexOf("DISCOUNT"),{data:g}=await o.from("products").select("sku_code"),h=new Set((null==g?void 0:g.map(e=>e.sku_code))||[]),p=new Set,b=[];for(let s=1;s<e.length;s++){let r=e[s].split(",").map(e=>e.trim());if(r.length<t.length){b.push({sku_code:r[a]||"",product_name:r[n]||"",brand:r[i]||"",category:r[c]||"",price:0,discount:0,isValid:!1,error:"Row ".concat(s+1,": Insufficient columns")});continue}let l=r[a],o=r[n],d=r[i],x=r[c],g=r[m],f=u>=0?r[u]:"0",j=!0,y="";l&&o&&d&&x&&g?p.has(l)?(j=!1,y="Row ".concat(s+1,": Duplicate SKU in file")):p.add(l):(j=!1,y="Row ".concat(s+1,": Missing required fields"));let N=parseFloat(g),v=parseFloat(f)||0;j&&(isNaN(N)||N<=0)&&(j=!1,y="Row ".concat(s+1,": Invalid price")),j&&(isNaN(v)||v<0||v>100)&&(j=!1,y="Row ".concat(s+1,": Invalid discount (must be 0-100)")),b.push({sku_code:l,product_name:o,brand:d,category:x,price:N,discount:v,isValid:j,error:y,action:h.has(l)?"UPDATE":"INSERT"})}d(b),x(!0)},b=async()=>{u(!0);let e=i.filter(e=>e.isValid),r=0,a=0,l=0;for(let s of e)try{if("UPDATE"===s.action){let{error:e}=await o.from("products").update({product_name:s.product_name,category:s.category,unit_price:s.price,updated_at:new Date().toISOString()}).eq("sku_code",s.sku_code);e?(console.error("Error updating product:",e),l++):a++}else{let{error:e}=await o.from("products").insert({sku_code:s.sku_code,product_name:s.product_name,category:s.category,unit_price:s.price,is_active:!0});e?(console.error("Error inserting product:",e),l++):r++}}catch(e){console.error("Error processing product:",e),l++}h({added:r,updated:a,failed:l}),u(!1),(r>0||a>0)&&setTimeout(()=>{t(),s()},2e3)};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"h-10 w-10 bg-green-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(R.Z,{className:"h-5 w-5 text-green-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Upload CSV Products"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Import products from CSV file"})]})]}),(0,r.jsx)("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,r.jsx)(N.Z,{className:"h-5 w-5 text-gray-500"})})]}),(0,r.jsx)("div",{className:"p-6 space-y-6",children:c?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upload Preview"}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[(0,r.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(Z.Z,{className:"h-5 w-5 text-green-600"}),(0,r.jsxs)("span",{className:"font-medium text-green-900",children:[i.filter(e=>e.isValid&&"INSERT"===e.action).length," New Products"]})]})}),(0,r.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(Z.Z,{className:"h-5 w-5 text-blue-600"}),(0,r.jsxs)("span",{className:"font-medium text-blue-900",children:[i.filter(e=>e.isValid&&"UPDATE"===e.action).length," Updates"]})]})}),(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(I.Z,{className:"h-5 w-5 text-red-600"}),(0,r.jsxs)("span",{className:"font-medium text-red-900",children:[i.filter(e=>!e.isValid).length," Errors"]})]})})]}),(0,r.jsx)("div",{className:"max-h-64 overflow-y-auto border border-gray-200 rounded-lg",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"bg-gray-50 sticky top-0",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"text-left p-3 font-medium text-gray-600",children:"Status"}),(0,r.jsx)("th",{className:"text-left p-3 font-medium text-gray-600",children:"Action"}),(0,r.jsx)("th",{className:"text-left p-3 font-medium text-gray-600",children:"SKU"}),(0,r.jsx)("th",{className:"text-left p-3 font-medium text-gray-600",children:"Product Name"}),(0,r.jsx)("th",{className:"text-left p-3 font-medium text-gray-600",children:"Brand"}),(0,r.jsx)("th",{className:"text-left p-3 font-medium text-gray-600",children:"Category"}),(0,r.jsx)("th",{className:"text-left p-3 font-medium text-gray-600",children:"Price"}),(0,r.jsx)("th",{className:"text-left p-3 font-medium text-gray-600",children:"Discount"})]})}),(0,r.jsx)("tbody",{children:i.map((e,s)=>(0,r.jsxs)("tr",{className:"border-t border-gray-100 ".concat(e.isValid?"":"bg-red-50"),children:[(0,r.jsx)("td",{className:"p-3",children:e.isValid?(0,r.jsx)(Z.Z,{className:"h-4 w-4 text-green-600"}):(0,r.jsx)(I.Z,{className:"h-4 w-4 text-red-600"})}),(0,r.jsx)("td",{className:"p-3",children:e.isValid?(0,r.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat("INSERT"===e.action?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"),children:e.action}):(0,r.jsx)("span",{className:"text-red-600 text-xs",children:e.error})}),(0,r.jsx)("td",{className:"p-3 font-mono",children:e.sku_code}),(0,r.jsx)("td",{className:"p-3 text-gray-900",children:e.product_name}),(0,r.jsx)("td",{className:"p-3 text-gray-900",children:e.brand}),(0,r.jsx)("td",{className:"p-3 text-gray-900",children:e.category}),(0,r.jsx)("td",{className:"p-3",children:e.isValid?(0,r.jsxs)("span",{className:"text-gray-900",children:["Rp ",e.price.toLocaleString("id-ID")]}):(0,r.jsx)("span",{className:"text-red-600",children:e.error})}),(0,r.jsx)("td",{className:"p-3",children:e.isValid?(0,r.jsxs)("span",{className:"text-gray-900",children:[e.discount,"%"]}):(0,r.jsx)("span",{className:"text-gray-500",children:"-"})})]},s))})]})})]}),g&&(0,r.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(Z.Z,{className:"h-5 w-5 text-green-600"}),(0,r.jsxs)("span",{className:"font-medium text-green-900",children:["Upload complete! ",g.added," added, ",g.updated," updated, ",g.failed," failed"]})]})}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{onClick:()=>x(!1),disabled:m,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 disabled:opacity-50 transition-colors",children:"Back"}),(0,r.jsx)("button",{onClick:b,disabled:m||0===i.filter(e=>e.isValid).length,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:m?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,r.jsx)("span",{children:"Uploading..."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(R.Z,{className:"h-4 w-4"}),(0,r.jsxs)("span",{children:["Confirm Upload (",i.filter(e=>e.isValid).length," products)"]})]})})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)(U.Z,{className:"h-5 w-5 text-blue-600 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-blue-900 mb-2",children:"CSV Format Required"}),(0,r.jsx)("p",{className:"text-sm text-blue-700 mb-3",children:"Columns: SKU_CODE, PRODUCT_NAME, BRAND, CATEGORY, PRICE, DISCOUNT (optional)"}),(0,r.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1",children:[(0,r.jsx)("li",{children:" First row must be headers"}),(0,r.jsx)("li",{children:" Use comma as delimiter"}),(0,r.jsx)("li",{children:" DISCOUNT column is optional (defaults to 0)"}),(0,r.jsx)("li",{children:" Existing SKUs will be updated, new SKUs will be added"})]})]})]}),(0,r.jsxs)("button",{onClick:()=>{let e=new Blob(["SKU_CODE,PRODUCT_NAME,BRAND,CATEGORY,PRICE,DISCOUNT\nSKU001,L'Or\xe9al Paris Voluminous Mascara,L'Or\xe9al Paris,Makeup,185000,10\nSKU002,Garnier Fructis Shampoo,Garnier,Hair Care,45000,0\nSKU003,Maybelline Foundation,Maybelline,Makeup,125000,15"],{type:"text/csv"}),s=window.URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download="product_template.csv",document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(s)},className:"inline-flex items-center px-3 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,r.jsx)(D.Z,{className:"h-4 w-4 mr-1"}),"Template"]})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select CSV File"}),(0,r.jsx)("input",{type:"file",accept:".csv",onChange:e=>{var s;let t=null===(s=e.target.files)||void 0===s?void 0:s[0];t&&"text/csv"===t.type?n(t):alert("Please select a valid CSV file")},className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"}),l&&(0,r.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["Selected: ",l.name," (",(l.size/1024).toFixed(1)," KB)"]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{onClick:s,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,r.jsx)("button",{onClick:p,disabled:!l,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Parse CSV"})]})]})})]})})}function z(e){let{user:s,userRole:t}=e,[l,n]=(0,a.useState)([]),[i,d]=(0,a.useState)([]),[c,x]=(0,a.useState)(["All"]),[m,u]=(0,a.useState)(!0),[g,h]=(0,a.useState)(""),[p,b]=(0,a.useState)("All"),[f,j]=(0,a.useState)(!1),[y,N]=(0,a.useState)(!1),[v,w]=(0,a.useState)(null);(0,a.useEffect)(()=>{_()},[]),(0,a.useEffect)(()=>{k()},[l,g,p]);let _=async()=>{try{let{data:e,error:s}=await o.from("products").select("\n          *,\n          promotions(\n            id,\n            discount_percentage,\n            start_date,\n            end_date,\n            is_active\n          )\n        ").eq("is_active",!0).order("product_name");if(s)throw s;n(e||[]),d(e||[]);let t=["All",...new Set((e||[]).map(e=>e.category))];x(t)}catch(e){console.error("Error fetching products:",e),n([]),d([])}finally{u(!1)}},k=()=>{let e=l;g&&(e=e.filter(e=>e.product_name.toLowerCase().includes(g.toLowerCase())||e.sku_code.toLowerCase().includes(g.toLowerCase())||e.category.toLowerCase().includes(g.toLowerCase()))),"All"!==p&&(e=e.filter(e=>e.category===p)),d(e)},S=e=>{if(!e.promotions)return null;let s=new Date().toISOString().split("T")[0];return e.promotions.find(e=>e.is_active&&e.start_date<=s&&e.end_date>=s)},O=e=>{let s=S(e);if(!s)return e.unit_price;let t=e.unit_price*(s.discount_percentage/100);return e.unit_price-t};return(0,r.jsxs)("div",{className:"p-6 space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"Product Catalog"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Manage your L'Or\xe9al product inventory"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:["admin"===t&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("button",{onClick:()=>N(!0),className:"inline-flex items-center px-3 py-1.5 text-sm bg-green-600 text-white rounded hover:bg-green-700 transition-colors",children:[(0,r.jsx)(C.Z,{className:"h-3 w-3 mr-1"}),"Upload CSV"]}),(0,r.jsxs)("button",{onClick:()=>j(!0),className:"inline-flex items-center px-3 py-1.5 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:[(0,r.jsx)(C.Z,{className:"h-3 w-3 mr-1"}),"Import Products"]})]}),(0,r.jsxs)("button",{className:"inline-flex items-center px-3 py-1.5 text-sm bg-gradient-to-r from-orange-500 to-red-500 text-white rounded hover:from-orange-600 hover:to-red-600 transition-all duration-200 shadow-sm",children:[(0,r.jsx)(C.Z,{className:"h-3 w-3 mr-1"}),"Add Product"]})]})]}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,r.jsxs)("div",{className:"flex-1 relative",children:[(0,r.jsx)(A.Z,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-3 w-3 text-gray-400"}),(0,r.jsx)("input",{type:"text",value:g,onChange:e=>h(e.target.value),placeholder:"Search products...",className:"w-full pl-8 pr-3 py-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent text-gray-900"})]}),(0,r.jsx)("div",{className:"flex gap-2 overflow-x-auto",children:c.map(e=>(0,r.jsx)("button",{onClick:()=>b(e),className:"whitespace-nowrap px-3 py-1.5 text-xs font-medium rounded transition-colors ".concat(p===e?"bg-orange-100 text-orange-700 border border-orange-200":"text-gray-600 bg-gray-100 hover:bg-gray-200"),children:e},e))})]})}),m?(0,r.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"})}):(0,r.jsx)("div",{className:"space-y-3",children:0===i.length?(0,r.jsx)("div",{className:"text-center py-8 text-sm text-gray-500",children:g||"All"!==p?"Tidak ada produk yang sesuai dengan filter":"Belum ada produk. Tambahkan produk pertama Anda!"}):i.map(e=>{let s=S(e),a=O(e),l=s&&a<e.unit_price,n={Makeup:{bg:"bg-pink-100",text:"text-pink-600",border:"border-pink-200"},"Hair Care":{bg:"bg-teal-100",text:"text-teal-600",border:"border-teal-200"},Skincare:{bg:"bg-blue-100",text:"text-blue-600",border:"border-blue-200"},Fragrance:{bg:"bg-purple-100",text:"text-purple-600",border:"border-purple-200"},"Body Care":{bg:"bg-green-100",text:"text-green-600",border:"border-green-200"}}[e.category]||{bg:"bg-gray-100",text:"text-gray-600",border:"border-gray-200"},i=e.category.charAt(0).toUpperCase();return(0,r.jsx)("div",{className:"bg-white rounded border border-gray-200 hover:shadow-sm hover:border-gray-300 transition-all duration-200",children:(0,r.jsxs)("div",{className:"flex items-center p-3 gap-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded ".concat(n.bg," ").concat(n.border," border flex items-center justify-center"),children:(0,r.jsx)("span",{className:"text-sm font-bold ".concat(n.text),children:i})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-1",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h3",{className:"font-semibold text-gray-900 text-xs leading-tight truncate",children:e.product_name}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,r.jsx)("span",{className:"text-xs text-gray-600 font-mono",children:e.sku_code}),(0,r.jsx)("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium ".concat(n.bg," ").concat(n.text),children:e.category})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 ml-4",children:[l&&(0,r.jsxs)("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:["-",null==s?void 0:s.discount_percentage,"%"]}),(0,r.jsx)("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium ".concat(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Active":"Inactive"})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,r.jsx)("div",{className:"flex items-center gap-2",children:l?(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsxs)("span",{className:"text-sm font-bold text-red-600",children:["Rp ",a.toLocaleString("id-ID")]}),(0,r.jsxs)("span",{className:"text-xs text-gray-500 line-through",children:["Rp ",e.unit_price.toLocaleString("id-ID")]})]}):(0,r.jsxs)("span",{className:"text-sm font-bold text-gray-900",children:["Rp ",e.unit_price.toLocaleString("id-ID")]})}),"admin"===t&&(0,r.jsx)("div",{className:"flex items-center gap-1",children:(0,r.jsx)("button",{onClick:()=>w(e),className:"p-1.5 text-gray-400 hover:text-orange-600 hover:bg-orange-50 rounded transition-colors",title:"Edit Product",children:(0,r.jsx)(F.Z,{className:"h-3 w-3"})})})]})]})]})},e.id)})}),f&&(0,r.jsx)(G,{onClose:()=>j(!1),onSuccess:()=>{_()}}),y&&(0,r.jsx)(B,{onClose:()=>N(!1),onSuccess:()=>{_()}}),v&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Edit Product"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"Product editing functionality coming soon..."}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)("button",{onClick:()=>w(null),className:"px-4 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors",children:"Close"})})]})})]})}function Y(e){let{user:s,userRole:t}=e,[l,n]=(0,a.useState)({totalSales:0,storeVisits:0,conversionRate:0,avgOrderValue:0}),[i,d]=(0,a.useState)([]),[c,x]=(0,a.useState)([]),[m,u]=(0,a.useState)(!0),[g,h]=(0,a.useState)({start:new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]});(0,a.useEffect)(()=>{p()},[g,s.id,t]);let p=async()=>{u(!0);try{let e=o.from("visits").select("\n          id,\n          visit_date,\n          has_order,\n          stores!inner(store_name, store_code),\n          visit_orders(\n            quantity,\n            line_total,\n            products!inner(product_name, sku_code)\n          )\n        ").gte("visit_date",g.start).lte("visit_date",g.end);"admin"!==t&&(e=e.eq("salesman_id",s.id));let{data:r,error:a}=await e;if(a)throw a;let l=(null==r?void 0:r.length)||0,i=(null==r?void 0:r.filter(e=>e.has_order))||[],c=(null==r?void 0:r.reduce((e,s)=>{var t;return e+((null===(t=s.visit_orders)||void 0===t?void 0:t.reduce((e,s)=>e+s.line_total,0))||0)},0))||0,m=l>0?i.length/l*100:0,u=i.length>0?c/i.length:0;n({totalSales:c,storeVisits:l,conversionRate:m,avgOrderValue:u});let h=new Map;null==r||r.forEach(e=>{let s=e.stores.store_code,t=h.get(s)||{store_name:e.stores.store_name,store_code:e.stores.store_code,total_orders:0,total_amount:0,visit_count:0};if(t.visit_count++,e.has_order){var r;t.total_orders++,t.total_amount+=(null===(r=e.visit_orders)||void 0===r?void 0:r.reduce((e,s)=>e+s.line_total,0))||0}h.set(s,t)});let p=Array.from(h.values()).sort((e,s)=>s.total_amount-e.total_amount).slice(0,5);d(p);let b=[];null==r||r.forEach(e=>{var s;null===(s=e.visit_orders)||void 0===s||s.forEach(s=>{b.push({date:e.visit_date,store_name:e.stores.store_name,product_name:s.products.product_name,sku_code:s.products.sku_code,quantity:s.quantity,amount:s.line_total})})});let f=b.sort((e,s)=>new Date(s.date).getTime()-new Date(e.date).getTime()).slice(0,10);x(f)}catch(e){console.error("Error fetching reports data:",e),n({totalSales:0,storeVisits:0,conversionRate:0,avgOrderValue:0}),d([]),x([])}finally{u(!1)}};return(0,r.jsxs)("div",{className:"p-6 space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Sales Reports"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Track your performance and analyze trends"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"date",value:g.start,onChange:e=>h(s=>({...s,start:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"}),(0,r.jsx)("input",{type:"date",value:g.end,onChange:e=>h(s=>({...s,end:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),(0,r.jsxs)("button",{className:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-lg hover:from-orange-600 hover:to-red-600 transition-all duration-200 shadow-sm",children:[(0,r.jsx)(D.Z,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-600",children:"Total Sales"}),(0,r.jsx)(j.Z,{className:"h-5 w-5 text-gray-400"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:m?"...":"Rp ".concat(l.totalSales.toLocaleString("id-ID"))}),(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"Period total"})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-600",children:"Store Visits"}),(0,r.jsx)(j.Z,{className:"h-5 w-5 text-gray-400"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:m?"...":l.storeVisits}),(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"Total visits"})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-600",children:"Conversion Rate"}),(0,r.jsx)(j.Z,{className:"h-5 w-5 text-gray-400"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:m?"...":"".concat(l.conversionRate.toFixed(1),"%")}),(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"Visits with orders"})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-600",children:"Avg Order Value"}),(0,r.jsx)(j.Z,{className:"h-5 w-5 text-gray-400"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:m?"...":"Rp ".concat(l.avgOrderValue.toLocaleString("id-ID"))}),(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"Per order"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Top Stores"}),m?(0,r.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-orange-600"})}):0===i.length?(0,r.jsx)("div",{className:"text-center py-8 text-gray-500",children:"Belum ada data penjualan"}):(0,r.jsx)("div",{className:"space-y-4",children:i.map((e,s)=>(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsxs)("span",{className:"font-medium text-gray-900",children:[e.store_name," (",e.store_code,")"]}),(0,r.jsxs)("span",{className:"text-gray-600",children:["Rp ",e.total_amount.toLocaleString("id-ID")]})]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 h-2 rounded-full transition-all duration-300",style:{width:"".concat(i.length>0?e.total_amount/i[0].total_amount*100:0,"%")}})}),(0,r.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,r.jsxs)("span",{children:[e.total_orders," orders"]}),(0,r.jsxs)("span",{children:[e.visit_count," visits"]})]})]},e.store_code))})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Sales Trend"}),(0,r.jsx)("div",{className:"h-64 flex items-center justify-center bg-gray-50 rounded-lg",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(j.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),(0,r.jsx)("p",{className:"text-gray-500",children:"Chart visualization coming soon"})]})})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Sales Activity"}),m?(0,r.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-orange-600"})}):0===c.length?(0,r.jsx)("div",{className:"text-center py-8 text-gray-500",children:"Belum ada aktivitas penjualan"}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Date"}),(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Store"}),(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Product"}),(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"SKU"}),(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Quantity"}),(0,r.jsx)("th",{className:"text-left py-3 px-4 font-medium text-gray-600",children:"Amount"})]})}),(0,r.jsx)("tbody",{children:c.map((e,s)=>(0,r.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"py-3 px-4 text-gray-900",children:e.date}),(0,r.jsx)("td",{className:"py-3 px-4 text-gray-900",children:e.store_name}),(0,r.jsx)("td",{className:"py-3 px-4 text-gray-900",children:e.product_name}),(0,r.jsx)("td",{className:"py-3 px-4 text-gray-600 font-mono text-xs",children:e.sku_code}),(0,r.jsx)("td",{className:"py-3 px-4 text-gray-900",children:e.quantity}),(0,r.jsxs)("td",{className:"py-3 px-4 font-medium text-gray-900",children:["Rp ",e.amount.toLocaleString("id-ID")]})]},s))})]})})]})]})}var W=t(6994),H=t(6086),J=t(7150);function Q(e){let{user:s,userRole:t}=e,[l,n]=(0,a.useState)(!1),i=[{title:"User Management",description:"Manage sales team members and permissions",icon:W.Z,color:"blue",items:["Add new users","Assign roles","Manage permissions","View user activity"]},{title:"Product Management",description:"Manage product catalog and inventory",icon:R.Z,color:"green",items:[{name:"Import Products",action:()=>n(!0)},"Manage categories","Update pricing","Product analytics"]},{title:"System Settings",description:"Configure application preferences",icon:y.Z,color:"gray",items:["General settings","Notification preferences","Data export options","Integration settings"]},{title:"Security",description:"Security and access control settings",icon:H.Z,color:"red",items:["Password policies","Two-factor authentication","Session management","Audit logs"]}],o=e=>{let s={blue:"bg-blue-100 text-blue-600",gray:"bg-gray-100 text-gray-600",green:"bg-green-100 text-green-600",red:"bg-red-100 text-red-600"};return s[e]||s.gray};return(0,r.jsxs)("div",{className:"p-6 space-y-6",children:[(0,r.jsx)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Management"}),(0,r.jsx)("p",{className:"text-gray-600",children:"System administration and configuration"})]})}),(0,r.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:i.map(e=>{let s=e.icon;return(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,r.jsx)("div",{className:"h-10 w-10 rounded-lg flex items-center justify-center ".concat(o(e.color)),children:(0,r.jsx)(s,{className:"h-5 w-5"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.title}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]})]}),(0,r.jsx)("div",{className:"space-y-2",children:e.items.map((e,s)=>"object"==typeof e?(0,r.jsx)("button",{onClick:e.action,className:"w-full text-left p-3 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors",children:(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e.name})},s):(0,r.jsx)("button",{className:"w-full text-left p-3 rounded-lg border border-gray-200 hover:bg-gray-50 transition-colors",children:(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e})},s))})]},e.title)})}),(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3 mb-6",children:[(0,r.jsx)("div",{className:"h-10 w-10 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(J.Z,{className:"h-5 w-5 text-purple-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"System Status"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Current system health and statistics"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[(0,r.jsx)("div",{className:"h-3 w-3 bg-green-500 rounded-full mx-auto mb-2"}),(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Database"}),(0,r.jsx)("p",{className:"text-xs text-gray-600",children:"Operational"})]}),(0,r.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[(0,r.jsx)("div",{className:"h-3 w-3 bg-green-500 rounded-full mx-auto mb-2"}),(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"API Services"}),(0,r.jsx)("p",{className:"text-xs text-gray-600",children:"Operational"})]}),(0,r.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[(0,r.jsx)("div",{className:"h-3 w-3 bg-green-500 rounded-full mx-auto mb-2"}),(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"File Storage"}),(0,r.jsx)("p",{className:"text-xs text-gray-600",children:"Operational"})]})]}),(0,r.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:"99.9%"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Uptime"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:"156"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Active Users"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:"2.3GB"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Storage Used"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:"1,247"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"API Calls Today"})]})]})})]}),l&&(0,r.jsx)(G,{onClose:()=>n(!1),onSuccess:()=>{}})]})}var X=t(4926),$=t(6111);function ee(e){let{onClose:s,onSuccess:t}=e,[l,n]=(0,a.useState)(null),[i,d]=(0,a.useState)([]),[c,x]=(0,a.useState)([]),[m,u]=(0,a.useState)(!1),[g,h]=(0,a.useState)(!1),[p,b]=(0,a.useState)(null),f=async()=>{if(!l)return;let e=(await l.text()).trim().split("\n");if(e.length<2){alert("CSV file must have at least a header row and one data row");return}let s=e[0].split(",").map(e=>e.trim().toUpperCase()),t=["CATEGORY","SKU_CODE","PRODUCT_NAME","PRIORITY"].filter(e=>!s.includes(e));if(t.length>0){alert("Missing required columns: ".concat(t.join(", ")));return}let r=s.indexOf("CATEGORY"),a=s.indexOf("SKU_CODE"),n=s.indexOf("PRODUCT_NAME"),i=s.indexOf("PRIORITY"),o=s.indexOf("NOTES"),c=new Set,m=[];for(let s=1;s<e.length;s++){let t=e[s].split(",").map(e=>e.trim().replace(/^"|"$/g,"")),l=t[r]||"",d=t[a]||"",x=t[n]||"",u=t[i]||"",g=o>=0&&t[o]||"",h=!0,p="";l&&d&&x&&u?c.has("".concat(l,"-").concat(d))?(h=!1,p="Row ".concat(s+1,": Duplicate SKU in same category")):c.add("".concat(l,"-").concat(d)):(h=!1,p="Row ".concat(s+1,": Missing required fields (CATEGORY, SKU_CODE, PRODUCT_NAME, PRIORITY)"));let b=parseInt(u);h&&(isNaN(b)||b<1)&&(h=!1,p="Row ".concat(s+1,": Invalid priority (must be positive integer)")),m.push({category:l,sku_code:d,product_name:x,priority:b,notes:g,isValid:h,error:p})}d(m);let g=m.filter(e=>e.isValid),h=new Map;g.forEach(e=>{h.has(e.category)||h.set(e.category,[]),h.get(e.category).push(e)}),x(Array.from(h.entries()).map(e=>{let[s,t]=e;return{category:s,count:t.length,items:t.sort((e,s)=>e.priority-s.priority)}})),u(!0)},j=async()=>{h(!0);let e=i.filter(e=>e.isValid);try{for(let s of[...new Set(e.map(e=>e.category))]){let{error:e}=await o.from("msl_items").delete().eq("category",s);if(e)throw e}let r=e.map(e=>({category:e.category,sku_code:e.sku_code,product_name:e.product_name,priority:e.priority,notes:e.notes||null})),{error:a}=await o.from("msl_items").insert(r);if(a)throw a;let l={};c.forEach(e=>{l[e.category]=e.count}),b(l),setTimeout(()=>{t(),s()},2e3)}catch(e){console.error("Error uploading MSL:",e),alert("Failed to upload MSL. Please try again.")}finally{h(!1)}};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"h-10 w-10 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(R.Z,{className:"h-5 w-5 text-blue-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Upload MSL (Must Selling List)"}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Upload CSV to completely replace current MSL data"})]})]}),(0,r.jsx)("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,r.jsx)(N.Z,{className:"h-5 w-5 text-gray-500"})})]}),(0,r.jsx)("div",{className:"p-6 space-y-6",children:m?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"MSL Upload Preview"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,r.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(Z.Z,{className:"h-5 w-5 text-green-600"}),(0,r.jsxs)("span",{className:"font-medium text-green-900",children:[i.filter(e=>e.isValid).length," Valid Items"]})]})}),(0,r.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(U.Z,{className:"h-5 w-5 text-blue-600"}),(0,r.jsxs)("span",{className:"font-medium text-blue-900",children:[c.length," Categories"]})]})}),(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(I.Z,{className:"h-5 w-5 text-red-600"}),(0,r.jsxs)("span",{className:"font-medium text-red-900",children:[i.filter(e=>!e.isValid).length," Errors"]})]})})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"Categories to be updated:"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:c.map(e=>(0,r.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:[(0,r.jsx)("div",{className:"font-medium text-gray-900",children:e.category}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[e.count," MSL items"]})]},e.category))})]}),i.filter(e=>!e.isValid).length>0&&(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h4",{className:"font-medium text-red-900 mb-3",children:"Items with errors:"}),(0,r.jsx)("div",{className:"max-h-32 overflow-y-auto border border-red-200 rounded-lg",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"bg-red-50 sticky top-0",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"text-left p-3 font-medium text-red-700",children:"Category"}),(0,r.jsx)("th",{className:"text-left p-3 font-medium text-red-700",children:"SKU"}),(0,r.jsx)("th",{className:"text-left p-3 font-medium text-red-700",children:"Product"}),(0,r.jsx)("th",{className:"text-left p-3 font-medium text-red-700",children:"Error"})]})}),(0,r.jsx)("tbody",{children:i.filter(e=>!e.isValid).map((e,s)=>(0,r.jsxs)("tr",{className:"border-t border-red-100",children:[(0,r.jsx)("td",{className:"p-3",children:e.category}),(0,r.jsx)("td",{className:"p-3 font-mono text-gray-900",children:e.sku_code}),(0,r.jsx)("td",{className:"p-3 text-gray-900",children:e.product_name}),(0,r.jsx)("td",{className:"p-3 text-red-600 text-xs",children:e.error})]},s))})]})})]})]}),p&&(0,r.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,r.jsx)(Z.Z,{className:"h-5 w-5 text-green-600"}),(0,r.jsx)("span",{className:"font-medium text-green-900",children:"MSL Updated Successfully!"})]}),(0,r.jsx)("div",{className:"text-sm text-green-700",children:Object.entries(p).map(e=>{let[s,t]=e;return(0,r.jsxs)("span",{className:"mr-4",children:[s," (",t," SKUs)"]},s)})})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{onClick:()=>u(!1),disabled:g,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 disabled:opacity-50 transition-colors",children:"Back"}),(0,r.jsx)("button",{onClick:j,disabled:g||0===i.filter(e=>e.isValid).length,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:g?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,r.jsx)("span",{children:"Uploading..."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)($.Z,{className:"h-4 w-4"}),(0,r.jsxs)("span",{children:["Replace All MSL Data (",i.filter(e=>e.isValid).length," items)"]})]})})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)(I.Z,{className:"h-5 w-5 text-yellow-600 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-yellow-900 mb-2",children:"Complete MSL Replacement"}),(0,r.jsx)("p",{className:"text-sm text-yellow-700 mb-3",children:"This upload will completely replace ALL existing MSL data. All current MSL items will be deleted and replaced with the CSV content."}),(0,r.jsxs)("ul",{className:"text-sm text-yellow-700 space-y-1",children:[(0,r.jsx)("li",{children:" Use this for monthly MSL updates"}),(0,r.jsx)("li",{children:" Ensure your CSV contains the complete MSL for all categories"}),(0,r.jsx)("li",{children:" Missing categories will be removed from the system"})]})]})]})}),(0,r.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)(U.Z,{className:"h-5 w-5 text-blue-600 mt-0.5"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium text-blue-900 mb-2",children:"CSV Format Required"}),(0,r.jsx)("p",{className:"text-sm text-blue-700 mb-3",children:"Required columns: CATEGORY, SKU_CODE, PRODUCT_NAME, PRIORITY"}),(0,r.jsx)("p",{className:"text-sm text-blue-700 mb-3",children:"Optional columns: NOTES"}),(0,r.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1",children:[(0,r.jsx)("li",{children:" First row must be headers"}),(0,r.jsx)("li",{children:" Use comma as delimiter"}),(0,r.jsx)("li",{children:" Priority must be positive integers (1, 2, 3...)"}),(0,r.jsx)("li",{children:" Categories can be any text value"}),(0,r.jsx)("li",{children:" Lower priority numbers = higher importance"})]})]})]}),(0,r.jsxs)("button",{onClick:()=>{let e=new Blob(["CATEGORY,SKU_CODE,PRODUCT_NAME,PRIORITY,NOTES\nGT PROV,LOR001,L'Oreal Paris Voluminous Mascara,1,Top seller - high margin\nGT PROV,LOR002,L'Oreal Paris Foundation,2,Popular shade range\nGT PROV,GAR001,Garnier Fructis Shampoo,3,Volume driver\nGT Wholesale,LOR004,L'Oreal Wholesale Pack A,1,Bulk discount available\nGT Wholesale,GAR002,Garnier Wholesale Bundle,2,High volume product\nGT Small Cosmetics,LOR005,L'Oreal Mini Lipstick Set,1,Perfect for small stores\nGT Small Cosmetics,GAR003,Garnier Travel Size,2,Impulse purchase"],{type:"text/csv"}),s=window.URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download="msl_template.csv",document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(s)},className:"inline-flex items-center px-3 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,r.jsx)(D.Z,{className:"h-4 w-4 mr-1"}),"Template"]})]})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select CSV File"}),(0,r.jsx)("input",{type:"file",accept:".csv",onChange:e=>{var s;let t=null===(s=e.target.files)||void 0===s?void 0:s[0];t&&"text/csv"===t.type?n(t):alert("Please select a valid CSV file")},className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),l&&(0,r.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["Selected: ",l.name," (",(l.size/1024).toFixed(1)," KB)"]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,r.jsx)("button",{onClick:s,className:"px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),(0,r.jsx)("button",{onClick:f,disabled:!l,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Parse CSV"})]})]})})]})})}function es(e){let{user:s,userRole:t}=e,[l,n]=(0,a.useState)([]),[i,d]=(0,a.useState)([]),[c,x]=(0,a.useState)([]),[m,u]=(0,a.useState)(""),[g,h]=(0,a.useState)(!0),[f,j]=(0,a.useState)(!1),[y,N]=(0,a.useState)(null);(0,a.useEffect)(()=>{v(),w();let e=e=>{u(e.detail)};return window.addEventListener("setMSLCategory",e),()=>{window.removeEventListener("setMSLCategory",e)}},[]);let v=async()=>{try{let{data:e,error:s}=await o.from("msl_items").select("*").order("category").order("priority");if(s)throw s;n(e||[]);let t=[...new Set((e||[]).map(e=>e.category))];d(t),t.length>0&&!m&&u(t[0])}catch(e){console.error("Error fetching MSL data:",e),n([]),d([])}finally{h(!1)}},w=async()=>{try{let{data:e,error:s}=await o.from("msl_items").select("category");if(s)throw s;let{data:t,error:r}=await o.from("stores").select("category");if(r)throw r;let a=(e||[]).reduce((e,s)=>(e[s.category]=(e[s.category]||0)+1,e),{}),l=(t||[]).reduce((e,s)=>(e[s.category]=(e[s.category]||0)+1,e),{}),n=new Set([...Object.keys(a),...Object.keys(l)]),i=Array.from(n).map(e=>({category:e,itemCount:a[e]||0,storeCount:l[e]||0}));x(i)}catch(e){console.error("Error fetching category stats:",e),x([])}},_=e=>{N(e)},k=e=>{e.preventDefault()},S=async(e,s)=>{if(e.preventDefault(),!y||y.id===s.id||y.category!==s.category){N(null);return}try{let{error:e}=await o.from("msl_items").update({priority:s.priority}).eq("id",y.id);if(e)throw e;let{error:t}=await o.from("msl_items").update({priority:y.priority}).eq("id",s.id);if(t)throw t;v()}catch(e){console.error("Error updating priorities:",e)}N(null)},C=()=>l.filter(e=>e.category===m),O=e=>c.find(s=>s.category===e);return(0,r.jsxs)("div",{className:"p-6 space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"MSL Management"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Manage Must Selling List recommendations by category"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("button",{onClick:()=>{let e=new Blob([["CATEGORY,SKU_CODE,PRODUCT_NAME,PRIORITY,NOTES",...l.map(e=>"".concat(e.category,",").concat(e.sku_code,',"').concat(e.product_name,'",').concat(e.priority,',"').concat(e.notes||"",'"'))].join("\n")],{type:"text/csv"}),s=window.URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download="msl_export_".concat(new Date().toISOString().split("T")[0],".csv"),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(s)},className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[(0,r.jsx)(D.Z,{className:"h-4 w-4 mr-2"}),"Export MSL"]}),"admin"===t&&(0,r.jsxs)("button",{onClick:()=>j(!0),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,r.jsx)(R.Z,{className:"h-4 w-4 mr-2"}),"Upload MSL"]})]})]}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:c.map(e=>(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("h3",{className:"font-medium text-gray-900",children:e.category}),(0,r.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,r.jsx)(b.Z,{className:"h-4 w-4 text-blue-600"}),(0,r.jsx)("span",{className:"text-sm text-blue-600",children:e.itemCount}),(0,r.jsx)(p.Z,{className:"h-4 w-4 text-green-600 ml-2"}),(0,r.jsx)("span",{className:"text-sm text-green-600",children:e.storeCount})]})]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[e.itemCount," MSL items  ",e.storeCount," stores"]})]},e.category))}),g?(0,r.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[(0,r.jsx)("div",{className:"border-b border-gray-200",children:(0,r.jsx)("nav",{className:"flex space-x-8 px-6","aria-label":"Tabs",children:i.map(e=>{let s=O(e);return(0,r.jsxs)("button",{onClick:()=>u(e),className:"py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ".concat(m===e?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e,s&&(0,r.jsx)("span",{className:"ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs",children:s.itemCount})]},e)})})}),(0,r.jsx)("div",{className:"p-6",children:m&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:[m," MSL Items"]}),(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:[C().length," items  Drag to reorder priority"]})]}),0===C().length?(0,r.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No MSL items for this category"}):(0,r.jsx)("div",{className:"space-y-2",children:C().map(e=>(0,r.jsxs)("div",{draggable:"admin"===t,onDragStart:()=>_(e),onDragOver:k,onDrop:s=>S(s,e),className:"flex items-center p-4 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors ".concat("admin"===t?"cursor-move":""," ").concat((null==y?void 0:y.id)===e.id?"opacity-50":""),children:["admin"===t&&(0,r.jsx)(X.Z,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,r.jsx)("div",{className:"flex items-center justify-center w-8 h-8 bg-blue-100 text-blue-600 rounded-full text-sm font-bold mr-4",children:e.priority}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3 mb-1",children:[(0,r.jsx)("span",{className:"font-mono text-sm text-gray-600 bg-gray-200 px-2 py-1 rounded",children:e.sku_code}),(0,r.jsx)("h4",{className:"font-medium text-gray-900 truncate",children:e.product_name})]}),e.notes&&(0,r.jsx)("p",{className:"text-sm text-gray-600 truncate",children:e.notes})]})]},e.id))})]})})]})}),f&&(0,r.jsx)(ee,{onClose:()=>j(!1),onSuccess:()=>{v(),w()}})]})}function et(e){var s;let{user:t}=e,[l,n]=(0,a.useState)("overview"),[i,c]=(0,a.useState)(!1),[x,m]=(0,a.useState)("salesman");(0,a.useEffect)(()=>{u()},[]);let u=async()=>{try{let{data:e,error:s}=await o.from("users").select("role").eq("id",t.id).single();s?console.error("Error fetching user role:",s):m((null==e?void 0:e.role)||"salesman")}catch(e){console.error("Error getting user role:",e)}},g=async()=>{await o.auth.signOut()},_=[{id:"overview",name:"Beranda",icon:h.Z},{id:"stores",name:"Toko",icon:p.Z},{id:"products",name:"Produk",icon:b.Z},{id:"msl",name:"MSL Management",icon:f.Z},{id:"reports",name:"Laporan",icon:j.Z}];return"admin"===x&&_.push({id:"management",name:"Kelola",icon:y.Z}),(0,r.jsxs)("div",{className:"flex h-screen bg-gray-50",children:[i&&(0,r.jsx)("div",{className:"fixed inset-0 z-40 lg:hidden",onClick:()=>c(!1),children:(0,r.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75"})}),(0,r.jsxs)("div",{className:"\n        fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-xl transform transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0\n        ".concat(i?"translate-x-0":"-translate-x-full","\n      "),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between h-16 px-6 border-b border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"h-8 w-8 bg-gradient-to-r from-loreal-orange to-loreal-red rounded-lg flex items-center justify-center",children:(0,r.jsx)(d.Z,{className:"h-5 w-5 text-white"})}),(0,r.jsx)("span",{className:"text-xl font-bold text-gray-900",children:"L'Or\xe9al"})]}),(0,r.jsx)("button",{onClick:()=>c(!1),className:"lg:hidden p-1 rounded-md hover:bg-gray-100",children:(0,r.jsx)(N.Z,{className:"h-6 w-6 text-gray-600"})})]}),(0,r.jsx)("nav",{className:"mt-6 px-3",children:(0,r.jsx)("div",{className:"space-y-1",children:_.map(e=>{let s=e.icon;return(0,r.jsxs)("button",{onClick:()=>{n(e.id),c(!1)},className:"\n                    w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg transition-colors\n                    ".concat(l===e.id?"bg-orange-50 text-loreal-orange border-r-2 border-loreal-orange":"text-gray-600 hover:bg-gray-50 hover:text-gray-900","\n                  "),children:[(0,r.jsx)(s,{className:"mr-3 h-5 w-5"}),e.name]},e.id)})})}),(0,r.jsxs)("div",{className:"absolute bottom-0 w-full p-4 border-t border-gray-200 space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3 mb-4",children:[(0,r.jsx)("div",{className:"h-8 w-8 bg-gray-300 rounded-full flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:null===(s=t.email)||void 0===s?void 0:s.charAt(0).toUpperCase()})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.email}),(0,r.jsx)("p",{className:"text-xs text-gray-500 capitalize",children:x})]})]}),(0,r.jsxs)("button",{onClick:g,className:"w-full flex items-center px-3 py-2 text-sm font-medium text-gray-600 rounded-lg hover:bg-gray-50 hover:text-gray-900 transition-colors",children:[(0,r.jsx)(v.Z,{className:"mr-3 h-5 w-5"}),"Keluar"]}),(0,r.jsx)("div",{className:"text-center",children:(0,r.jsxs)("p",{className:"text-xs text-gray-400 opacity-75 leading-relaxed",children:["Made with  by Ahnaf for Salesman Stint Project.",(0,r.jsx)("br",{}),"MT Commercial CPD 2025"]})})]})]}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,r.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-200 lg:hidden",children:(0,r.jsxs)("div",{className:"flex items-center justify-between h-16 px-4",children:[(0,r.jsx)("button",{onClick:()=>c(!0),className:"p-2 rounded-md hover:bg-gray-100",children:(0,r.jsx)(w.Z,{className:"h-6 w-6 text-gray-600"})}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("div",{className:"h-6 w-6 bg-gradient-to-r from-loreal-orange to-loreal-red rounded flex items-center justify-center",children:(0,r.jsx)(d.Z,{className:"h-4 w-4 text-white"})}),(0,r.jsx)("span",{className:"text-lg font-bold text-gray-900",children:"L'Or\xe9al"})]})]})}),(0,r.jsx)("main",{className:"flex-1 overflow-y-auto",children:(()=>{switch(l){case"overview":default:return(0,r.jsx)(T,{user:t,userRole:x});case"stores":return(0,r.jsx)(q,{user:t,userRole:x,setActiveTab:n});case"products":return(0,r.jsx)(z,{user:t,userRole:x});case"msl":return(0,r.jsx)(es,{user:t,userRole:x});case"reports":return(0,r.jsx)(Y,{user:t,userRole:x});case"management":return(0,r.jsx)(Q,{user:t,userRole:x})}})()})]})]})}function er(){let[e,s]=(0,a.useState)(null),[t,l]=(0,a.useState)(!0);return((0,a.useEffect)(()=>{o.auth.getSession().then(e=>{var t;let{data:{session:r}}=e;s(null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null),l(!1)});let{data:{subscription:e}}=o.auth.onAuthStateChange((e,t)=>{var r;s(null!==(r=null==t?void 0:t.user)&&void 0!==r?r:null),l(!1)});return()=>e.unsubscribe()},[]),t)?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-loreal-orange"})}):(0,r.jsx)("main",{className:"min-h-screen",children:e?(0,r.jsx)(et,{user:e}):(0,r.jsx)(g,{})})}}},function(e){e.O(0,[997,971,117,744],function(){return e(e.s=2869)}),_N_E=e.O()}]);